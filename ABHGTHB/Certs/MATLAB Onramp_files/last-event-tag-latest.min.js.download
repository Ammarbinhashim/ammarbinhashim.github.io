!function r(s,n,o){function a(t,e){if(!n[t]){if(!s[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(c)return c(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}i=n[t]={exports:{}},s[t][0].call(i.exports,function(e){return a(s[t][1][e]||e)},i,i.exports,r,s,n,o)}return n[t].exports}for(var c="function"==typeof require&&require,e=0;e<o.length;e++)a(o[e]);return a}({1:[function(e,t,i){t.exports={AdCloudCookie:e("./AdCloudCookieUtils")()}},{"./AdCloudCookieUtils":2}],2:[function(t,e,i){e.exports=function(){var o=t("js-cookie"),e={getTLD:function(){for(var e=document.domain||document.location.hostname,t=e.split("."),i=0,r="-tld-IhQJ0wbEdH8Zpylse209g",i=t.length-1;0<=i;i--){var s=t.slice(i).join("."),n={domain:s};if(o.set(r,"a",n),"a"==o.get(r))return o.remove(r,n),s}return e},init:function(){if(void 0===window.adCloudCookieData){var e=o.get("adcloud");if(void 0===e||""==e)window.adCloudCookieData={};else for(var t in window.adCloudCookieData=JSON.parse(e),window.adCloudCookieData){var i=adCloudCookieData[t].split(",");parseInt((new Date).valueOf()/1e3)>parseInt(i[2])&&delete adCloudCookieData[t]}}},get:function(e){return void 0===window.adCloudCookieData&&init(),window.adCloudCookieData&&window.adCloudCookieData[e]?window.adCloudCookieData[e]:""},set:function(e,t,i,r){var s,n=new Date;void 0===r&&(r=this.getTLD()),void 0!==i?void 0===i.endsWith?s=new Date(n.getFullYear(),n.getMonth(),n.getDate()+parseInt(i),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()):i.endsWith("D")||i.endsWith("d")?s=new Date(n.getFullYear(),n.getMonth(),n.getDate()+parseInt(i.substring(0,i.length-1)),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()):i.endsWith("M")||i.endsWith("m")?s=new Date(n.getFullYear(),n.getMonth()+parseInt(i.substring(0,i.length-1)),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()):i.endsWith("MIN")||i.endsWith("min")?s=new Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes()+parseInt(i.substring(0,i.length-3)),n.getSeconds(),n.getMilliseconds()):(i.endsWith("Y")||i.endsWith("y"))&&(s=new Date(n.getFullYear()+parseInt(i.substring(0,i.length-1)),n.getMonth(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds())):s=new Date(n.getFullYear()+2,n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()),window.adCloudCookieData[e]=new Array(t,r,parseInt(s.valueOf()/1e3)).toString(),o.remove("adcloud"),o.set("adcloud",JSON.stringify(window.adCloudCookieData),{expires:731,path:"/",domain:r})}};return void 0===window.adCloudCookieData&&e.init(),e}},{"js-cookie":7}],3:[function(e,t,i){t.exports=function(){return e("@id5io/id5-api.js")}},{"@id5io/id5-api.js":6}],4:[function(d,e,t){e.exports=function(){return function(e,t,i,r,s){this.imsOrgId=e,this.rsid=t,this.cookieInstance=d("./AdCloudCookie").AdCloudCookie;var h=this,u={};function n(t){function i(e){void 0!==e?(r=e,h.rampIdEnv=JSON.parse(r).envelope,void 0===h.rampIdEnv||""==h.rampIdEnv||u.rampIdCallInitiated||(u.makeLastEventCall(t,void 0,"r"),u.rampIdCallInitiated=!0)):setTimeout(function(){void 0!==window.ats&&u.checkVisitorCookieExpired(o,"r")&&void 0===r&&0!=s?(s--,n++,window.ats.retrieveEnvelope().then(function(e){i(e)},function(e){})):0!=s&&(s--,n++,i(e))},500*n)}var r,e,s=5,n=1;void 0!==window.ats?void 0!==(e=window.ats.outputCurrentConfiguration())&&void 0!==e.DETECTION_MODULE_INFO&&window.ats.retrieveEnvelope().then(function(e){void 0!==e?i(e):window.addEventListener("lrEnvelopePresent",function(){window.ats.retrieveEnvelope().then(function(e){i(e)})})}):i()}u.retrieveCookie=function(e){e=h.cookieInstance.get(e);return void 0!==e&&""!==e&&1<e.split(",").length?e.split(",")[0]:""},u.checkVisitorCookieExpired=function(e,t){e=h.cookieInstance.get(e);if(void 0!==e&&""!==e&&1==e.split(";").length){var i=e.split(",");if(void 0===t)return i[0];if(3==i.length)return!1;if(e[0]==t&&3<e.split(",").length){i=e.split(",");if(Number.parseInt(i[3])>Math.floor(Date.now()/1e3))return!1}}else if(void 0!==e&&""!==e)for(var r=e.split(";"),s=0;s<r.length;s++){var n=r[s];if(n[0]==t&&(i=n.split(","),Number.parseInt(i[3])>Math.floor(Date.now()/1e3)))return!1}return!0},u.setVisitorCookie=function(e){for(var t="_les_v",i=(o=h.cookieInstance.get(t)).split(";"),r=[],s=0;s<i.length;s++){var n=i[s];e.includes(n[0])||r.push(n)}for(var o=r.join(";"),a=e.split(","),c=0;c<a.length;c++){var l="",l=""==o?a[c]+",y":o+";"+a[c]+",y";h.cookieInstance.set(t,l,"30MIN"),o=h.cookieInstance.get(t)}},u.expireCookie=function(e,t){h.cookieInstance.set(e,t,"-1D")},u.hasEfIDURL=function(){var e=this.getEfIdQParam();return null!=e&&""!==e},u.hasSKWCIDURL=function(){var e=this.getSKWCIDQParam();return null!=e&&""!==e},u.getEfIdQParam=function(){return this.getQParam("ef_id")},u.getSKWCIDQParam=function(){return this.getQParam("s_kwcid")},u.getQParam=function(e){var t=!!window.MSInputMethodContext&&!!document.documentMode,i=window.location.href;if(t){var r={},t=document.createElement("a");t.href=i;for(var s=t.search.substring(1).split("&"),n=0;n<s.length;n++){var o=s[n].split("=");r[o[0]]=decodeURIComponent(o[1])}return r[e]}return new URL(i).searchParams.get(e)},u.generateRandomId=function(e){if(void 0===u.randomId){var t,i,r="0123456789",s="",n="",o=8;for(r+="ABCDEF",t=0;t<16;t++)i=Math.floor(Math.random()*o),s+=r.substring(i,i+1),i=Math.floor(Math.random()*o),n+=r.substring(i,i+1),o=16;u.randomId=s+"-"+n}return u.randomId},u.makeLastEventCall=function(e,t,i){var r,s,n=h.imsOrgId,o=h.rsid,a="",c="",l=i.split(","),d=(void 0!==this.id5&&l.includes("i")&&(c=this.id5),void 0!==h.rampIdEnv&&l.includes("r")&&(a=h.rampIdEnv),"https://lasteventf-tm.everesttech.net"),l=(null!=e&&""!==e&&(d=e),"_les_lsc");void 0!==h.cookieInstance&&(this.hasEfIDURL()||this.hasSKWCIDURL())&&(e=Date.now(),h.cookieInstance.set(l,e,"91D")),this.hasEfIDURL()||this.hasSKWCIDURL()?h.noLESCall=!0:(r="",void 0!==h.cookieInstance&&(r=u.retrieveCookie(l)),"undefined"!=typeof Visitor?(e=Visitor.getInstance(n),void 0===(s=e.getSupplementalDataID("AdCloud:les1"))&&(s=u.generateRandomId()),(l=e.getMarketingCloudVisitorID(function(e){u.executeCall(d,u.createQueryString(n,s,r,o,e,a,c),i,t)}))&&u.executeCall(d,u.createQueryString(n,s,r,o,l,a,c),i,t)):"undefined"!=typeof alloy&&alloy("getIdentity").then(function(e){mid=e.identity.ECID;e=u.generateRandomId();u.executeCall(d,u.createQueryString(n,e,r,o,mid,a,c),i,t)}).catch(function(e){}))},u.createQueryString=function(e,t,i,r,s,n,o){return"?_les_imsOrgId="+e+"&_les_sdid="+t+"&_les_last_search_click="+i+"&_les_rsid="+r+"&_les_mid="+s+"&_les_rampid_env="+n+"&_les_id5="+o+"&_les_url="+encodeURIComponent(window.location.href)},u.executeCall=function(e,t,i,r){var s=new XMLHttpRequest;s.onreadystatechange=function(){4==this.readyState&&200==this.status&&(u.setVisitorCookie(i),"function"==typeof r)&&r(s)},s.open("GET",e+t,!0),s.withCredentials=!0,s.send(null)};var o="_les_v";if(!i){var a,c,l=new Array;try{if(u.checkVisitorCookieExpired(o,"r")&&void 0!==(a=void 0!==(a=function(){for(var e="_lr_env=",t=document.cookie.split(";"),i=0;i<t.length;i++){var r=t[i].trim();if(0===r.indexOf(e))return JSON.parse(atob(decodeURIComponent(decodeURIComponent(r.substring(e.length,r.length)))))}return""}())&&""!=a?a:function(){if(null!==localStorage.getItem("_lr_env"))return JSON.parse(atob(localStorage.getItem("_lr_env")))}())&&""!=a&&(h.rampIdEnv=a.envelope,void 0===h.rampIdEnv||""==h.rampIdEnv||u.rampIdCallInitiated||l.push("r")),u.checkVisitorCookieExpired(o,"c")&&l.push("c"),void 0!==window.id5PartnerId&&""!==window.id5PartnerId&&u.checkVisitorCookieExpired(o,"i")&&(d("./id5.js")(),c=window.ID5.init({partnerId:window.id5PartnerId}),u.id5=c.getUserId(),void 0===u.id5||""==u.id5?(u.delayedCall=!0,window.ID5.init({partnerId:window.id5PartnerId}).onAvailable(function(e){u.id5=e.getUserId(),void 0!==u.id5&&""!=u.id5?l.push("i"):(d("./id5.js")(),window.ID5.init({partnerId:window.id5PartnerId}).onAvailable(function(e){u.id5=e.getUserId(),void 0===u.id5||""==u.id5||u.id5CallInitiated||(u.id5CallInitiated=!0,u.makeLastEventCall(r,s,"i"))})),u.makeLastEventCall(r,s,l.join(","))},1e3)):l.push("i")),0!=l.length&&!u.delayedCall&&(u.makeLastEventCall(r,s,l.join(",")),3==l.length))return;u.checkVisitorCookieExpired(o,"r")&&!l.includes("r")&&n(r)}catch(e){try{console.log("Failure making last event call.",e)}catch(e){}}}return u}}},{"./AdCloudCookie":1,"./id5.js":3}],5:[function(e,t,i){e=e("./les.js")();window.AdCloudEvent=e},{"./les.js":4}],6:[function(e,t,i){!function(){"use strict";function F(t,e){var i,r=Object.keys(t);return Object.getOwnPropertySymbols&&(i=Object.getOwnPropertySymbols(t),e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,i)),r}function h(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?F(Object(i),!0).forEach(function(e){c(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):F(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function M(e,t,i,r,s,n,o){try{var a=e[n](o),c=a.value}catch(e){return i(e)}a.done?t(c):Promise.resolve(c).then(r,s)}function n(a){return function(){var e=this,o=arguments;return new Promise(function(t,i){var r=a.apply(e,o);function s(e){M(r,t,i,s,n,"next",e)}function n(e){M(r,t,i,s,n,"throw",e)}s(void 0)})}}function c(e,t,i){var r;(t="symbol"==typeof(r=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return String(e);if("object"!=typeof(t=i.call(e,"string")))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(t))?r:String(r))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}function p(){return(p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i,r=arguments[t];for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var r,s,n,o,a=[],c=!0,l=!1;try{if(n=(i=i.call(e)).next,0===t){if(Object(i)!==i)return;c=!1}else for(;!(c=(r=n.call(i)).done)&&(a.push(r.value),a.length!==t);c=!0);}catch(e){l=!0,s=e}finally{try{if(!c&&null!=i.return&&(o=i.return(),Object(o)!==o))return}finally{if(l)throw s}}return a}}(e,t)||j(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(e,t){var i;if(e)return"string"==typeof e?V(e,t):"Map"===(i="Object"===(i=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:i)||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?V(e,t):void 0}function V(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function u(e,t){var i,r,s,n,o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(o)return s=!(r=!0),{s:function(){o=o.call(e)},n:function(){var e=o.next();return r=e.done,e},e:function(e){s=!0,i=e},f:function(){try{r||null==o.return||o.return()}finally{if(s)throw i}}};if(Array.isArray(e)||(o=j(e))||t&&e&&"number"==typeof e.length)return o&&(e=o),n=0,{s:t=function(){},n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}class e{debug(){}info(){}warn(){}error(){}}const _=new e;class G extends e{constructor(e,t){super(),this._prefix=e,this._delegate=t}debug(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this._delegate.debug(this._prefix,...t)}info(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this._delegate.info(this._prefix,...t)}warn(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this._delegate.warn(this._prefix,...t)}error(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this._delegate.error(this._prefix,...t)}}class W{constructor(e,t,i,r,s,n){var o=6<arguments.length&&void 0!==arguments[6]?arguments[6]:void 0;c(this,"_isId5Message",!0),c(this,"id",void 0),c(this,"timestamp",void 0),c(this,"type",void 0),c(this,"src",void 0),c(this,"dst",void 0),c(this,"request",void 0),c(this,"payload",void 0),this.id=r,this.timestamp=e,this.src=t,this.dst=i,this.type=n,this.request=o,this.payload=s}}class H{constructor(e){c(this,"_senderId",void 0),c(this,"_messageSeqNb",0),this._senderId=e,this._messageSeqNb=0}createBroadcastMessage(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:e.constructor.name;return new W(Date.now(),this._senderId,void 0,++this._messageSeqNb,e,t||e.constructor.name)}createResponse(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:t.constructor.name;return new W(Date.now(),this._senderId,e.src,++this._messageSeqNb,t,i||t.constructor.name,e)}createUnicastMessage(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:t.constructor.name;return new W(Date.now(),this._senderId,e,++this._messageSeqNb,t,i||t.constructor.name)}}class o{constructor(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0;c(this,"instance",void 0),c(this,"instanceState",void 0),c(this,"isResponse",void 0),this.instance=e,this.instanceState=i,this.isResponse=t}}c(o,"TYPE","HelloMessage");const a=Object.freeze({LEADER:"leader",FOLLOWER:"follower",STORAGE:"storage"});class s{constructor(e,t,i){c(this,"target",void 0),c(this,"methodName",void 0),c(this,"methodArguments",void 0),this.target=e,this.methodName=t,this.methodArguments=i}}c(s,"TYPE","RemoteMethodCallMessage");class q{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:_;c(this,"_targets",{}),c(this,"_log",void 0),this._log=e}registerTarget(e,t){return this._targets[e]=t,this}_handle(e){var t=this._targets[e.target];if(t)try{t[e.methodName](...e.methodArguments)}catch(t){this._log.error("Error while handling method call ",e,t)}}}class J{constructor(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:_;c(this,"_id",void 0),c(this,"_messageFactory",void 0),c(this,"_log",void 0),c(this,"_onMessageCallBackFunction",void 0),this._id=e,this._messageFactory=new H(this._id),this._log=i,this._window=t,this._handlers={},this._register()}_register(){const r=this;r._abortController="undefined"!=typeof AbortController?new AbortController:void 0;var e=null==(e=r._abortController)?void 0:e.signal;r._window.addEventListener("message",t=>{let i=t.data;if(void 0!==t.data&&t.data._isId5Message)if(t.data.src!==r._id)if(void 0===t.data.dst||t.data.dst===r._id)try{["*",i.type].forEach(e=>{e=r._handlers[e];e&&e.forEach(e=>e(i,t.source))})}catch(e){r._log.error("Error while handling message",i,e)}else r._log.debug("Ignore msg not to me");else r._log.debug("Ignore loopback msg")},{capture:!1,signal:e})}unregister(){this._abortController&&this._abortController.abort()}onAnyMessage(e){return this.onMessage("*",e)}onMessage(e,t){var i=this._handlers[e];return i?i.push(t):this._handlers[e]=[t],this}broadcastMessage(e,t){this._log.debug("Broadcasting message",t,e),this._postMessage(this._messageFactory.createBroadcastMessage(e,t))}sendResponseMessage(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:t.constructor.name;this._log.debug("Sending response message",e,i,t),this._postMessage(this._messageFactory.createResponse(e,t,i))}unicastMessage(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:t.constructor.name;this._log.debug("Sending message to",e,i,t),this._postMessage(this._messageFactory.createUnicastMessage(e,t,i))}_postToWindow(e,t){try{e.postMessage(t,"*")}catch(e){this._log.error("Could not post message to window",e)}}_postMessage(r){let s=this;!function t(e){try{s._postToWindow(e,r);var i=e.frames;if(i)for(let e=0;e<i.length;e++)t(i[e])}catch(e){s._log.error("Could not broadcast message",e)}}(s._window.top)}callProxyMethod(e,t,i,r){this._log.info("Calling ProxyMethodCall",{target:t,name:i,args:r}),this.unicastMessage(e,new s(t,i,r),s.TYPE)}onProxyMethodCall(t){return this.onMessage(s.TYPE,e=>{t._handle(p(new s,e.payload))})}}function B(e,t){var i,r,s="^\\d+(\\.\\d+(\\.\\d+){0,1}){0,1}$";if(e.match(s)&&t.match(s))return i=e.split("."),r=t.split("."),0===(t=(e=(e,t)=>0==(t=e-t)?0:t<0?-1:1)((s=e=>parseInt(e)||0)(i[0]),s(r[0])))&&0===(t=e(s(i[1]),s(r[1])))?e(s(i[2]),s(r[2])):t}const K="Array",Y="Function",z=Object.prototype.toString;function t(e,t){return z.call(e)==="[object "+t+"]"}function l(e){return t(e,Y)}function d(e){return t(e,"String")}function g(e){return t(e,K)}function Q(e){return t(e,"Number")}function i(e){return t(e,"Object")}function f(e){return void 0!==e}function X(t,i){if(!function(e){if(e){if(g(e)||d(e))return!(0<e.length);for(var t in e)if(hasOwnProperty.call(e,t))return}return 1}(t)){if(l(t.forEach))return t.forEach(i,this);let e=0;var r=t.length;if(0<r)for(;e<r;e++)i(t[e],e,t);else for(e in t)hasOwnProperty.call(t,e)&&i.call(this,t[e],e)}}function $(i,e){function r(e,t){var i;return l(Math.imul)?Math.imul(e,t):(i=(4194303&e)*(t|=0),4290772992&e&&(i+=(4290772992&e)*t|0),0|i)}let s=3735928559^(e=1<arguments.length&&void 0!==e?e:0),n=1103547991^e;for(let e=0,t;e<i.length;e++)t=i.charCodeAt(e),s=r(s^t,2654435761),n=r(n^t,1597334677);return s=r(s^s>>>16,2246822507)^r(n^n>>>13,3266489909),(4294967296*(2097151&(n=r(n^n>>>16,2246822507)^r(s^s>>>13,3266489909)))+(s>>>0)).toString()}const Z=["localStoragePurposeConsent","ccpaString"],m=Object.freeze({NONE:"none",TCF_V1:"TCFv1",TCF_V2:"TCFv2",USP_V1:"USPv1",ID5_ALLOWED_VENDORS:"ID5",PREBID:"PBJS",GPP_V1_0:"GPPv1.0",GPP_V1_1:"GPPv1.1"});class ee extends Error{constructor(e,t){super(t),c(this,"consentData",void 0),this.consentData=e}}class te{constructor(e,t,i,r){c(this,"version",void 0),c(this,"localStoragePurposeConsent",void 0),c(this,"applicableSections",void 0),c(this,"gppString",void 0),this.version=e,this.localStoragePurposeConsent=t,this.applicableSections=i,this.gppString=r}isGranted(){return this.applicableSections.includes(2)?this.localStoragePurposeConsent:!!this.applicableSections.includes(6)||!(!this.applicableSections.includes(0)&&!this.applicableSections.includes(-1)&&0!==this.applicableSections.length)&&(void 0===this.localStoragePurposeConsent||this.localStoragePurposeConsent)}}class I{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:m.NONE,t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0,r=3<arguments.length&&void 0!==arguments[3]&&arguments[3],s=4<arguments.length&&void 0!==arguments[4]?arguments[4]:void 0,n=5<arguments.length&&void 0!==arguments[5]?arguments[5]:void 0,o=6<arguments.length&&void 0!==arguments[6]&&arguments[6],a=7<arguments.length&&void 0!==arguments[7]?arguments[7]:void 0;c(this,"api",void 0),c(this,"gdprApplies",void 0),c(this,"consentString",void 0),c(this,"localStoragePurposeConsent",void 0),c(this,"allowedVendors",void 0),c(this,"ccpaString",void 0),c(this,"forcedGrantByConfig",void 0),c(this,"gppData",void 0),c(this,"source",void 0),this.api=e,this.gdprApplies=t,this.consentString=i,this.localStoragePurposeConsent=r,this.ccpaString=s,this.allowedVendors=n,this.forcedGrantByConfig=o,this.gppData=a}localStorageGrant(){var e=!0===this.forcedGrantByConfig?r.FORCE_ALLOWED_BY_CONFIG:void 0===this.api||this.api===m.NONE?r.PROVISIONAL:r.CONSENT_API;return new w(this.isGranted(),e,this.api)}isGranted(){switch(this.api){case m.NONE:return!0;case m.TCF_V1:return!this.gdprApplies||!0===this.localStoragePurposeConsent;case m.TCF_V2:case m.PREBID:return!1===this.gdprApplies||!0===this.localStoragePurposeConsent;case m.ID5_ALLOWED_VENDORS:return this.allowedVendors.includes("131");case m.USP_V1:return!0;case m.GPP_V1_0:case m.GPP_V1_1:return this.gppData.isGranted()}}hashCode(){this.localStoragePurposeConsent,this.ccpaString;var e=function(e,t){if(null==e)return{};var i,r=function(e,t){if(null==e)return{};for(var i,r={},s=Object.keys(e),n=0;n<s.length;n++)i=s[n],0<=t.indexOf(i)||(r[i]=e[i]);return r}(e,t);if(Object.getOwnPropertySymbols)for(var s=Object.getOwnPropertySymbols(e),n=0;n<s.length;n++)i=s[n],0<=t.indexOf(i)||Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i]);return r}(this,Z);return $(JSON.stringify(e))}}const r=Object.freeze({FORCE_ALLOWED_BY_CONFIG:"force_allowed_by_config",ID5_CONSENT:"id5_consent",PROVISIONAL:"provisional",JURISDICTION:"jurisdiction",CONSENT_API:"consent_api"});class w{constructor(e,t,i){c(this,"allowed",!1),c(this,"grantType",r.NONE),c(this,"api",m.NONE),this.allowed=e,this.grantType=t,this.api=i}isDefinitivelyAllowed(){return this.allowed&&this.grantType!==r.PROVISIONAL}}var C=Object.freeze({STORAGE_CONFIG:{ID5:{name:"id5id",expiresDays:90},ID5_V2:{name:"id5id_v2",expiresDays:15},LAST:{name:"id5id_last",expiresDays:90},CONSENT_DATA:{name:"id5id_cached_consent_data",expiresDays:30},PRIVACY:{name:"id5id_privacy",expiresDays:30}},LEGACY_COOKIE_NAMES:["id5.1st","id5id.1st"],PRIVACY:{JURISDICTIONS:{gdpr:!0,ccpa:!1,lgpd:!0,other:!1}},ID5_EIDS_SOURCE:"id5-sync.com"});class ie{constructor(e,t){this.name=e,this.expiresDays=t}withNameSuffixed(){let e=this.name;for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];for(var s=0,n=i;s<n.length;s++){var o=n[s];e+="_".concat(o)}return new ie(e,this.expiresDays)}}class y{constructor(){let i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;function e(e){var t=void 0!==i?Math.max(1,i):e.expiresDays;return new ie(e.name,t)}var t=C.STORAGE_CONFIG;this.ID5=e(t.ID5),this.ID5_V2=e(t.ID5_V2),this.LAST=e(t.LAST),this.CONSENT_DATA=e(t.CONSENT_DATA),this.PRIVACY=e(t.PRIVACY)}}c(y,"DEFAULT",new y);class re{constructor(e){c(this,"_clientStore",void 0),this._clientStore=e}hasConsentChanged(e){return e&&!this._clientStore.storedConsentDataMatchesConsentData(e)}storeConsent(e){this._clientStore.putHashedConsentData(e)}incNb(e){this._clientStore.incNbV2(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:1)}updateNbs(e){var t,i=u(e);try{for(i.s();!(t=i.n()).done;){var r=v(t.value,2),s=r[0],n=r[1],o=null==n?void 0:n.nb;0<o&&this.incNb(s,-o)}}catch(e){i.e(e)}finally{i.f()}}storeResponse(e,i){this._clientStore.putResponseV1(i.getGenericResponse()),this._clientStore.setResponseDateTimeV1(new Date(i.timestamp).toUTCString());const r=new Set;e.forEach(e=>{var t=e.cacheId;r.has(t)||(e=i.getResponseFor(e.integrationId))&&(this._clientStore.storeResponseV2(t,e,i.timestamp),r.add(t))})}clearAll(e){this._clientStore.clearResponse(),this._clientStore.clearDateTime(),e.forEach(e=>{e=e.cacheId,this._clientStore.clearResponseV2(e)}),this._clientStore.clearHashedConsentData()}getCachedResponse(e){if(e=this._clientStore.getStoredResponseV2(e))return new se(e.response,e.responseTimestamp,e.nb)}}class se{constructor(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;c(this,"response",void 0),c(this,"timestamp",void 0),c(this,"nb",void 0),this.response=e,this.timestamp=t,this.nb=i}isExpired(){var e=this.getMaxAge();return!(Q(e)&&0<e)||this._isOlderThanSec(e)}_isOlderThanSec(e){return this.timestamp<=0||Date.now()-this.timestamp>1e3*e}isStale(){return!this.timestamp||this._isOlderThanSec(1209600)}isResponseComplete(){return i(this.response)&&d(this.response.universal_uid)&&d(this.response.signature)}isValid(){return this.isResponseComplete()&&!this.isStale()}getMaxAge(){var e;return null==(e=this.response)||null==(e=e.cache_control)?void 0:e.max_age_sec}}class ne{constructor(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];c(this,"lateJoiner",!1),c(this,"uniqueLateJoiner",!1),this.lateJoiner=e,this.uniqueLateJoiner=t}}class oe{updateConsent(){}updateFetchIdData(){}refreshUid(){}addFollower(){}getProperties(){}}class ae extends oe{constructor(e,t,i,r,s,n){var o=6<arguments.length&&void 0!==arguments[6]?arguments[6]:_,a=7<arguments.length?arguments[7]:void 0;super(),c(this,"_followers",void 0),c(this,"_followersRequests",{}),c(this,"_refreshRequired",{}),c(this,"_fetcher",void 0),c(this,"_log",void 0),c(this,"_consentManager",void 0),c(this,"_inProgressFetch",void 0),c(this,"_queuedRefreshOptions",void 0),c(this,"_lastConsentDataSet",void 0),c(this,"_metrics",void 0),c(this,"_leaderStorage",void 0),c(this,"_store",void 0),this._followers=[],this._fetcher=a,this._properties=t,this._consentManager=s,this._metrics=n,this._window=e,this._leaderStorage=i,this._log=o,this._store=r,this._firstFetchTriggered=!1}_handleRefreshResult(e,t){var i=t.refreshedResponse;if(void 0!==i){var r,s=u(e);try{for(s.s();!(r=s.n()).done;){var n=r.value.integrationId;this._followersRequests[n]=(this._followersRequests[n]||0)+1}}catch(e){s.e(e)}finally{s.f()}var o,a=[],c=u(this._followers);try{for(c.s();!(o=c.n()).done;){var l=o.value,d=i.getResponseFor(l.getId());void 0!==d&&(this._log.debug("Notify uid ready.","Follower:",l.getId(),"Uid:",d),this._refreshRequired[l.getId()]=!1,this._notifyUidReady(l,{timestamp:i.timestamp,responseObj:d,isFromCache:!1}),!0===d.cascade_needed)&&a.push(l.getId())}}catch(e){c.e(e)}finally{c.f()}void 0!==(t=t.consentData)&&0<a.length&&this._consentManager.localStorageGrant("leader-before-cascade").isDefinitivelyAllowed()&&this._handleCascade(a,i,t)}}_notifyUidReady(e,t){var i=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i={timestamp:Date.now(),tags:{lateJoiner:i,callType:e.callType}};e.notifyUidReady(t,i)}_handleCascade(e,t,i){var r=this._followers.filter(t=>void 0!==e.find(e=>t.getId()===e)&&t.canDoCascade()).sort((e,t)=>{function i(e){return(null==(e=e.getFetchIdData().refererInfo)||null==(e=e.stack)?void 0:e.length)||Number.MAX_SAFE_INTEGER}return i(e)-i(t)});0<r.length?(r=r[0]).notifyCascadeNeeded({partnerId:r.getFetchIdData().partnerId,userId:t.getResponseFor(r.getId()).universal_uid,gdprApplies:i.gdprApplies,consentString:i.consentString,gppString:null==(t=i.gppData)?void 0:t.gppString,gppSid:null==(i=i.gppData)||null==(r=i.applicableSections)?void 0:r.join(",")}):this._log.error("Couldn't find cascade eligible follower")}_handleCancel(e){var t,i=u(this._followers);try{for(i.s();!(t=i.n()).done;)t.value.notifyFetchUidCanceled({reason:e})}catch(e){i.e(e)}finally{i.f()}}_getId(){let n=0<arguments.length&&void 0!==arguments[0]&&arguments[0];const t=this._followers.map(e=>{var t=e.getId(),i=(this._followersRequests[t]||0)+1,r=this._properties.id,s=!0===this._refreshRequired[e.getId()];return n=n||s,h(h({},e.getFetchIdData()),{},{integrationId:t,requestCount:i,refresh:s,role:r===e.getId()?"leader":"follower",cacheId:e.getCacheId()})});this._inProgressFetch=!0,this._firstFetchTriggered=!0,this._fetcher.getId(t,n).then(e=>{this._handleRefreshResult(t,e),this._handleFetchCompleted()}).catch(e=>{e instanceof ee?this._handleCancel(e.message):this._handleFailed(e),this._handleFetchCompleted()})}start(){!0!==this._started&&(this._getId(!1),this._started=!0)}refreshUid(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};let t=1<arguments.length?arguments[1]:void 0;var i=!0===e.forceFetch;t&&(i?this._refreshRequired[t]=!0:(i=this._followers.find(e=>e.getId()===t))&&this._provisionFromCache(i)),this._callRefresh(e)}_callRefresh(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this._inProgressFetch?this._queuedRefreshOptions=e:(!0===e.resetConsent&&this._consentManager.resetConsentData(!0===e.forceAllowLocalStorageGrant),this._getId(!0===e.forceFetch))}updateConsent(e){var t,i,r=this._lastConsentDataSet;r&&(t=(null==e?void 0:e.api)!==r.api,i=(null==e?void 0:e.consentString)!==r.consentString,r=(null==e?void 0:e.ccpaString)!==r.ccpaString,t||i||r)&&this._metrics.consentChangeCounter({apiChanged:t,consentStringChanged:i,usPrivacyChanged:r}).inc(),this._consentManager.setConsentData(e),this._lastConsentDataSet=e}updateFetchIdData(t,e){var i=this._followers.find(e=>e.getId()===t),r=i.getCacheId();i.updateFetchIdData(e),(e=i.getCacheId())!==r&&(this._log.info("Follower",i.getId(),"cacheId changed from",r," to",e,"required refresh"),this._refreshRequired[i.getId()]=!0)}addFollower(t){var e=this._log,i=void 0===this._followers.find(e=>e.getCacheId()===t.getCacheId()),r=(this._followers.push(t),e.info("Added follower",t.getId(),"cacheId",t.getCacheId()),this._window!==t.getWindow()&&(r=t.getStorage(),e.info("Adding follower's",t.getId(),"storage as replica"),this._leaderStorage.addReplica(r)),this._provisionFromCache(t)),e=new ne;return!0===this._firstFetchTriggered&&(e.lateJoiner=!0,e.uniqueLateJoiner=i,r)&&this._callRefresh({forceFetch:!0}),e}_provisionFromCache(e){var t=this._log,i=e.getCacheId(),r=this._store.getCachedResponse(i),s=!r||!r.isValid()||r.isExpired();return this._refreshRequired[e.getId()]=s,void 0!==r&&r.isValid()?(t.info("Found valid cached response for follower",{id:e.getId(),cacheId:e.getCacheId()}),this._notifyUidReady(e,{timestamp:r.timestamp,responseObj:r.response,isFromCache:!0,willBeRefreshed:!!s}),this._store.incNb(i)):t.info("Couldn't find response for cacheId",e.getCacheId()),s}getProperties(){return this._properties}_handleFetchCompleted(){this._inProgressFetch=void 0,this._queuedRefreshOptions&&(this._callRefresh(this._queuedRefreshOptions),this._queuedRefreshOptions=void 0)}_handleFailed(e){this._log.error("Fetch id failed",e);var t,i=u(this._followers);try{for(i.s();!(t=i.n()).done;)t.value.notifyFetchUidCanceled({reason:"error"})}catch(e){i.e(e)}finally{i.f()}}}class ce extends oe{constructor(e,t){super(),c(this,"_messenger",void 0),c(this,"_leaderInstanceProperties",void 0),this._messenger=e,this._leaderInstanceProperties=t}_sendToLeader(e,t){this._messenger.callProxyMethod(this._leaderInstanceProperties.id,a.LEADER,e,t)}updateConsent(e){this._sendToLeader("updateConsent",[e])}refreshUid(e,t){this._sendToLeader("refreshUid",[e,t])}updateFetchIdData(e,t){this._sendToLeader("updateFetchIdData",[e,t])}getProperties(){return this._leaderInstanceProperties}}class le extends oe{constructor(){super(...arguments),c(this,"_callsQueue",[]),c(this,"_assignedLeader",void 0)}updateConsent(e){this._callOrBuffer("updateConsent",[e])}updateFetchIdData(e,t){this._callOrBuffer("updateFetchIdData",[e,t])}refreshUid(e,t){this._callOrBuffer("refreshUid",[e,t])}addFollower(e){return this._callOrBuffer("addFollower",[e])}getProperties(){if(this._assignedLeader)return this._assignedLeader.getProperties()}assignLeader(e){this._assignedLeader=e;var t,i=u(this._callsQueue);try{for(i.s();!(t=i.n()).done;){var r=t.value;this._callAssignedLeader(r.name,r.args)}}catch(e){i.e(e)}finally{i.f()}this._callsQueue=[]}_callOrBuffer(e,t){if(this._assignedLeader)return this._callAssignedLeader(e,t);this._callsQueue.push({name:e,args:t})}_callAssignedLeader(e,t){return this._assignedLeader[e](...t)}}const S=Object.freeze({CONSENT_UPDATED:"consent_updated",USER_ID_READY:"user_id_ready",CASCADE_NEEDED:"fire_sync_pixel",USER_ID_FETCH_CANCELED:"user_id_fetch_canceled",USER_ID_FETCH_FAILED:"user_id_fetch_failed"}),de=Object.freeze({ID5_MESSAGE_RECEIVED:"message",ID5_INSTANCE_JOINED:"instance-joined",ID5_LEADER_ELECTED:"leader-elected"}),he=Object.freeze([...Object.values(de),...Object.values(S)]);class ue{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:_;c(this,"_handlers",void 0),c(this,"_log",void 0),this._log=e,this._handlers={}}_dispatch(e){var t=this._handlers[e];if(t){for(var i=arguments.length,r=new Array(1<i?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];var n,o=u(t);try{for(o.s();!(n=o.n()).done;){var a=n.value;try{a(...r)}catch(t){this._log.error("Event ".concat(e," handler execution failed."),t)}}}catch(t){o.e(t)}finally{o.f()}}}emit(e){if(void 0!==e&&he.includes(e)){for(var t=arguments.length,i=new Array(1<t?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];this._dispatch(e,...i)}else this._log.warn("Unsupported event",e)}on(e,t){void 0!==e&&he.includes(e)?(this._handlers[e]||(this._handlers[e]=[]),this._handlers[e].push(t)):this._log.warn("Unsupported event",e)}}const ge="_exp";class pe{constructor(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:_;c(this,"storage",void 0),c(this,"_log",void 0),this.storage=e,this._log=t}getItem(e){try{return this.storage.getItem(e)}catch(e){}}setItem(e,t){try{this.storage.setItem(e,t)}catch(e){}}removeItem(e){try{this.storage.removeItem(e)}catch(e){}}removeExpiredObjectWithPrefix(t){var i=1<arguments.length&&void 0!==arguments[1]&&arguments[1];this._log.info("Check, prefix",t);try{var r=this.storage.getKeysWithPrefix(t);let e=0;var s,n=u(r);try{for(n.s();!(s=n.n()).done;){var o,a,c=s.value;i?(this._log.info("Found",c," remove it"),this.removeItem(c)):(a=null==(o=this.getObjectWithExpiration({name:c}))?void 0:o.expireAt)&&a<Date.now()&&(this._log.info("Found expired object",c,"expiration time",a,"It will be removed"),this.removeItem(c),e+=1)}}catch(e){n.e(e)}finally{n.f()}return{all:r.length,expired:e}}catch(e){}}getItemWithExpiration(e){var t=e.name;return!(e=this.getItem(t+ge))||new Date(e).getTime()-Date.now()<=0?(this.removeItemWithExpiration({name:t}),null):this.getItem(t)}setItemWithExpiration(e,t){var i=e.name,e=e.expiresDays,e=Date.now()+864e5*e,e=new Date(e).toUTCString();this.setItem(i+ge,e),this.setItem(i,t)}removeItemWithExpiration(e){e=e.name,this.removeItem(e),this.removeItem(e+ge)}setObjectWithExpiration(e,t){var i=e.name,e=e.expiresDays,e=Date.now()+864e5*e;this.setItem(i,JSON.stringify({data:t,expireAt:e}))}getObjectWithExpiration(e){e=e.name;try{var t=JSON.parse(this.getItem(e));if(t.expireAt&&0<t.expireAt-Date.now())return t.data;t.expireAt&&this.removeItem(e)}catch(t){this._log.error("Error while getting ",e,"object from storage",t)}}updateObjectWithExpiration(e,t){var i=e.name,e=e.expiresDays;try{var r=t(this.getObjectWithExpiration({name:i}));return this.setObjectWithExpiration({name:i,expiresDays:e},r),r}catch(e){this._log.error("Error while updating object with ",i,e)}}}class ve{getItem(){}removeItem(){}setItem(){}getKeysWithPrefix(){return[]}}const _e=new ve;class fe extends ve{constructor(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];super(),c(this,"_writingEnabled",void 0),c(this,"_underlying",void 0),this._writingEnabled=t;try{this._underlying=e.localStorage}catch(e){}}getItem(e){try{return this._underlying.getItem(e)}catch(e){}}removeItem(e){try{this._underlying.removeItem(e)}catch(e){}}setItem(e,t){try{this._writingEnabled&&this._underlying.setItem(e,t)}catch(e){}}getKeysWithPrefix(t){try{var i=this._underlying.length;if(this._writingEnabled){var r=[];for(let e=0;e<i;e++){var s=this._underlying.key(e);s&&s.startsWith(t)&&r.push(s)}return r}}catch(e){}}static checkIfAccessible(){var e="__id5test";try{return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch(e){return!1}}}class me{constructor(e){c(this,"_replicas",[]),c(this,"_lastKeyOperation",{}),c(this,"_primaryStorage",void 0),this._primaryStorage=e}getItem(e){return this._primaryStorage.getItem(e)}removeItem(t){this._primaryStorage.removeItem(t);var e=e=>{e.removeItem(t)};this._replicas.forEach(e),this._lastKeyOperation[t]=e}setItem(t,i){this._primaryStorage.setItem(t,i);var e=e=>{e.setItem(t,i)};this._replicas.forEach(e),this._lastKeyOperation[t]=e}addReplica(t){Object.values(this._lastKeyOperation).forEach(e=>e(t)),this._replicas.push(t)}getKeysWithPrefix(e){return this._primaryStorage.getKeysWithPrefix(e)}}const Ie=Object.freeze({DIRECT_METHOD:"direct_method",POST_MESSAGE:"post_message"});class we{constructor(e,t,i){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:_;c(this,"_instanceProperties",void 0),c(this,"_log",void 0),c(this,"callType",void 0),c(this,"_instanceWindow",void 0),this._instanceWindow=t,this._instanceProperties=i,this._log=r,this.callType=e}getId(){return this._instanceProperties.id}getFetchIdData(){return this._instanceProperties.fetchIdData}updateFetchIdData(e){p(this._instanceProperties.fetchIdData,e)}getCacheId(){var e={partnerId:(e=this._instanceProperties.fetchIdData).partnerId,att:e.att,pd:e.pd,provider:e.provider,abTesting:e.abTesting,segments:JSON.stringify(e.segments),providedRefresh:e.providedRefreshInSeconds};return $(JSON.stringify(e))}notifyUidReady(){}notifyFetchUidCanceled(){}notifyCascadeNeeded(){}canDoCascade(){return!0===this._instanceProperties.canDoCascade}getStorage(){return _e}getWindow(){return this._instanceWindow}}class Ce extends we{constructor(e,t,i){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:_;super(Ie.DIRECT_METHOD,e,t,r),c(this,"_dispatcher",void 0),this._dispatcher=i}notifyUidReady(e,t){this._dispatcher.emit(S.USER_ID_READY,e,t)}notifyFetchUidCanceled(e){this._dispatcher.emit(S.USER_ID_FETCH_CANCELED,e)}notifyCascadeNeeded(e){this._dispatcher.emit(S.CASCADE_NEEDED,e)}}class ye extends ve{constructor(e,t){super(),c(this,"_messenger",void 0),c(this,"_destinationId",void 0),this._messanger=e,this._destinationId=t}getItem(){}removeItem(e){this._remoteCall("removeItem",[e])}setItem(e,t){this._remoteCall("setItem",[e,t])}_remoteCall(e,t){this._messanger.callProxyMethod(this._destinationId,a.STORAGE,e,t)}}class Se extends we{constructor(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:_;super(Ie.POST_MESSAGE,e.getWindow(),e.properties,i),c(this,"_messenger",void 0),this._messenger=t}_callProxy(e,t){this._messenger.callProxyMethod(this.getId(),a.FOLLOWER,e,t)}notifyUidReady(e,t){this._callProxy("notifyUidReady",[e,t])}notifyFetchUidCanceled(e){this._callProxy("notifyFetchUidCanceled",[e])}notifyCascadeNeeded(e){this._callProxy("notifyCascadeNeeded",[e])}getStorage(){return new ye(this._messenger,this.getId())}}class De{constructor(){c(this,"_valuePromise",void 0),c(this,"_value",void 0),c(this,"_resolve",void 0),c(this,"_hasValue",void 0),this.reset()}reset(){this._value=void 0,this._hasValue=!1,this._valuePromise=new Promise(e=>{this._resolve=e})}set(e){this._hasValue?this._valuePromise=Promise.resolve(e):(this._hasValue=!0,this._resolve(e)),this._value=e}getValuePromise(){return this._valuePromise}hasValue(){return this._hasValue}getValue(){return this._value}}class be extends class{getConsentData(){}localStorageGrant(){}setStoredPrivacy(){}}{constructor(e,t,i,r,s){super(),c(this,"_consentDataHolder",void 0),c(this,"storedPrivacyData",void 0),c(this,"localStorage",void 0),c(this,"_forceAllowLocalStorageGrant",void 0),this._log=r,this.localStorage=e,this.storageConfig=t,this._consentDataHolder=new De,this._forceAllowLocalStorageGrant=i,this._metrics=s}isForceAllowLocalStorageGrant(){return this._forceAllowLocalStorageGrant}resetConsentData(e){this._consentDataHolder.reset(),this.storedPrivacyData=void 0,this._forceAllowLocalStorageGrant=e}localStorageGrant(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"unknown",i=this._getLocalStorageGrant();return null!=(e=this._metrics)&&null!=(t=e.localStorageGrantCounter({allowed:i.allowed,grantType:i.grantType,apiType:i.api,lsgContext:t,consentSet:null==(t=this._consentDataHolder)?void 0:t.hasValue()}))&&t.inc(),i}_getLocalStorageGrant(){var e,t=this._log;return!0===this._forceAllowLocalStorageGrant?(t.warn("cmpApi: Local storage access granted by configuration override, consent will not be checked"),new w(!0,r.FORCE_ALLOWED_BY_CONFIG,m.NONE)):this._consentDataHolder.hasValue()&&this._consentDataHolder.getValue().api!==m.NONE?this._consentDataHolder.getValue().localStorageGrant():(i(this.storedPrivacyData)||(e=this.localStorage.getItemWithExpiration(this.storageConfig.PRIVACY),this.storedPrivacyData=e&&JSON.parse(e),t.info("cmpApi: Loaded stored privacy data from local storage",this.storedPrivacyData)),this.storedPrivacyData&&!0===this.storedPrivacyData.id5_consent?new w(!0,r.ID5_CONSENT,m.NONE):this.storedPrivacyData&&f(this.storedPrivacyData.jurisdiction)?(e=(e=this.storedPrivacyData.jurisdiction)in C.PRIVACY.JURISDICTIONS&&C.PRIVACY.JURISDICTIONS[e],new w(!1===e,r.JURISDICTION,m.NONE)):new w(!0,r.PROVISIONAL,m.NONE))}setStoredPrivacy(e){var t=this._log;try{i(e)?(this.storedPrivacyData=e,this.localStorage.setItemWithExpiration(this.storageConfig.PRIVACY,JSON.stringify(e))):t.error("cmpApi: Cannot store privacy data if it is not an object",e)}catch(e){t.error("cmpApi: Error while storing privacy data",e)}}setConsentData(e){this._log.debug("Set consent data",e),e=p(new I,e),this._consentDataHolder.set(e)}getConsentData(){return this._consentDataHolder.getValuePromise()}}const Ee="undefined"!=typeof Promise&&"undefined"!=typeof fetch;class Ae{constructor(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;this.url=e||"https://diagnostics.id5-sync.com/measurements",this._metadata=t}publish(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;return e&&0<e.length?(e.forEach(e=>{var i;i=e.tags,Object.keys(i).forEach(function(e){var t=i[e];t&&(t instanceof Object?i[e]=JSON.stringify(t):i[e]="".concat(t))})}),fetch(this.url,{method:"POST",headers:{"Content-Type":"text/plain"},mode:"no-cors",body:JSON.stringify({metadata:h(h({},this._metadata),t),measurements:e})})):Promise.resolve()}}const Oe=Object.freeze({});Oe;var D,Pe=function(e){return e?e instanceof Map?Object.fromEntries(e):e:Oe},Te=function(e){return Array.from(Object.entries(e),e=>{var e=(t=v(e,2))[0],t=t[1];return"".concat(e,"=").concat(t)}).sort().toString()};const Re=Object.freeze({TIMER:"TIMER",SUMMARY:"SUMMARY",COUNTER:"COUNTER"});class xe{constructor(e,t,i){c(this,"name",void 0),c(this,"tags",void 0),c(this,"values",void 0),this.name=e,this.tags=Pe(t),this.type=i,this.values=[]}reset(){this.values=[]}}class Ue extends xe{constructor(e){super(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,Re.TIMER)}startMeasurement(){try{return new Ne(this)}catch(e){}}record(e){try{isNaN(e)||this.values.push({value:e,timestamp:Date.now()})}catch(e){}}recordNow(){try{var e;this.record(0|(null==(e=performance)?void 0:e.now()))}catch(e){}}}class Ne{constructor(){this.timer=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0,this.startTime=performance.now()}record(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;try{var t=performance.now()-this.startTime|0,i=e||this.timer;return i&&i.record(t),t}catch(e){}}}class ke extends xe{constructor(e){super(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,Re.COUNTER)}inc(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;try{return 0===this.values.length?this.values.push({value:e,timestamp:Date.now()}):(this.values[0].value+=e,this.values[0].timestamp=Date.now()),this.values[0].value}catch(e){}}}class Le extends xe{constructor(e){super(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,Re.SUMMARY)}record(e){try{this.values.push({value:e,timestamp:Date.now()})}catch(e){}}}class Fe{has(e){return void 0!==this[e]}set(e,t){return this[e]=t,this}get(e){return this[e]}values(){return Object.entries(this).map(e=>v(e,2)[1])}}function b(){return new Ne}function Me(e){return{partner:e}}class je extends class{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;c(this,"_registry",void 0),c(this,"commonTags",void 0),c(this,"_scheduled",void 0),this._registry=new Fe,this.commonTags=Pe(e),this.commonPrefix=t}getOrCreate(e,t,i){var r=h(h({},t),this.commonTags),t=this.commonPrefix?this.commonPrefix+"."+e:e,e="".concat(t,"[").concat(Te(r),"]");return this._registry.has(e)||this._registry.set(e,i(t,r)),this._registry.get(e)}getAllMeasurements(){return this._registry.values().map(e=>({name:e.name,type:e.type,tags:e.tags,values:e.values})).filter(function(e){return e.values&&0<e.values.length})}reset(){Array.from(this._registry.values()).forEach(e=>e.reset())}addCommonTags(e){this.commonTags=h(h({},this.commonTags),Pe(e))}timer(e){return this.getOrCreate(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},(e,t)=>new Ue(e,t))}counter(e){return this.getOrCreate(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},(e,t)=>new ke(e,t))}summary(e){return this.getOrCreate(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},(e,t)=>new Le(e,t))}publish(){let t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:e=>e,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;return Promise.resolve(this.getAllMeasurements()).then(e=>t(e,i)).then(()=>this.reset())}schedulePublishAfterMsec(t,i){if(!this._scheduled){let e=this;setTimeout(()=>(e._scheduled=!1,e.publish(i,{trigger:"fixed-time",fixed_time_msec:t})),t),this._scheduled=!0}return this}schedulePublishBeforeUnload(e){const t=this,i="undefined"!=typeof AbortController?new AbortController:void 0;return i&&(i.publisher=e,addEventListener("beforeunload",()=>t.publish(e,{trigger:"beforeunload"}),{capture:!1,signal:i.signal}),this._onUnloadPublishAbortController=i),this}unregister(){var e=this._onUnloadPublishAbortController;if(e)return e.abort(),this.publish(e.publisher,{trigger:"unregister"})}}{constructor(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:void 0;super(h(h({source:e,version:t},Me(i)),r),"id5.api")}loadDelayTimer(){return this.timer("instance.load.delay",0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}fetchCallTimer(e){return this.timer("fetch.call.time",h({status:e},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}))}fetchFailureCallTimer(){return this.fetchCallTimer("fail",0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}fetchSuccessfulCallTimer(){return this.fetchCallTimer("success",0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}extensionsCallTimer(e,t){return this.timer("extensions.call.time",h({extensionType:e,status:t?"success":"fail"},2<arguments.length&&void 0!==arguments[2]?arguments[2]:{}))}consentRequestTimer(e){return this.timer("consent.request.time",h({requestType:e},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}))}invocationCountSummary(){return this.summary("invocation.count",0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}instanceCounter(e){return this.counter("instance.count",h({instanceId:e},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}))}instanceUniqueDomainsCounter(e){return this.counter("instance.domains.count",h({instanceId:e},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}))}instanceUniqWindowsCounter(e){return this.counter("instance.windows.count",h({instanceId:e},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}))}instanceUniqPartnersCounter(e){return this.counter("instance.partners.count",h({instanceId:e},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}))}instanceJoinDelayTimer(){return this.timer("instance.join.delay.time",0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}instanceLateJoinCounter(e){return this.counter("instance.lateJoin.count",h({instanceId:e},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}))}instanceLateJoinDelayTimer(){return this.timer("instance.lateJoin.delay",h({},0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}))}instanceLastJoinDelayTimer(){return this.timer("instance.lastJoin.delay",h({},0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}))}instanceMsgDeliveryTimer(){return this.timer("instance.message.delivery.time",0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}userIdProvisioningDelayTimer(e){return this.timer("userid.provisioning.delay",h({cachedResponseUsed:e},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}))}userIdNotificationDeliveryDelayTimer(){return this.timer("userid.provisioning.delivery.delay",h({},0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}))}consentChangeCounter(){return this.counter("leader.consent.change.count",0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}storageAllKeysCounter(){return this.summary("storage.keys.all.count",0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}storageExpiredKeysCounter(){return this.summary("storage.keys.expired.count",0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}instanceSurvivalTime(){return this.timer("instance.survival.time",0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}localStorageGrantCounter(){return this.counter("consent.lsg.count",0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}consentDiscrepancyCounter(){return this.counter("consent.discrepancy.count",0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}}class Ve{constructor(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Date.now();c(this,"timestamp",void 0),c(this,"response",void 0),this.response=e,this.timestamp=t}getGenericResponse(){return this.response.generic}getResponseFor(e){if(this.response.responses[e])return h(h({},this.response.generic),this.response.responses[e])}}class Ge{constructor(e,t,i){c(this,"_extensionsProvider",void 0),c(this,"_metrics",void 0),c(this,"_log",void 0),this._extensionsProvider=e,this._metrics=t,this._log=i}refreshUid(e,l,d,h){return this._extensionsProvider.gather(e).then(n=>{const s=e.map(e=>{var t=d.get(e.cacheId),i=null==t||null==(s=t.response)?void 0:s.signature,r=null==t?void 0:t.nb,s=null==t?void 0:t.getMaxAge();return this._createRequest(l,e,i,r,s,n,h)}),o=this._log,a=this._metrics,c=this;return new Promise((t,i)=>{const r=b();var e="".concat("https://id5-sync.com").concat("/gm/v3");o.info("Fetching ID5 ID from:",e,s),function(e,r,s,n,t){n=3<arguments.length?n:{};let o=4<arguments.length&&void 0!==t?t:_;try{let i;var a,c=n.method||(s?"POST":"GET");document.createElement("a").href=e;let t="object"==typeof r&&null!==r?r:{success:function(){o.info("ajax","xhr success")},error:function(e){o.error("ajax","xhr error",null,e)}};"function"==typeof r&&(t.success=r),(i=new window.XMLHttpRequest).onreadystatechange=function(){var e;4===i.readyState&&(200<=(e=i.status)&&e<300||304===e?t.success(i.responseText,i):t.error(i.statusText,i))},i.ontimeout=function(){o.error("ajax","xhr timeout after ",i.timeout,"ms")},"GET"===c&&s&&(p((h=e,u=n,g=document.createElement("a"),u&&"noDecodeWholeURL"in u&&u.noDecodeWholeURL?g.href=h:g.href=decodeURIComponent(h),u=u&&"decodeSearchAsString"in u&&u.decodeSearchAsString,a={href:g.href,protocol:(g.protocol||"").replace(/:$/,""),hostname:g.hostname,port:+g.port,pathname:g.pathname.replace(/^(?!\/)/,"/"),search:u?g.search:(u=g.search||"")?u.replace(/^\?/,"").split("&").reduce((e,t)=>{let i=t.split("="),r=v(i,2),s=r[0],n=r[1];return/\[\]$/.test(s)?(e[s=s.replace("[]","")]=e[s]||[],e[s].push(n)):e[s]=n||"",e},{}):{},hash:(g.hash||"").replace(/^#/,""),host:g.host||window.location.host}).search,s),e=((l=a).protocol||"http")+"://"+(l.host||l.hostname+(l.port?":".concat(l.port):""))+(l.pathname||"")+(l.search?"?".concat((d=l.search||"",Object.keys(d).map(t=>Array.isArray(d[t])?d[t].map(e=>"".concat(t,"[]=").concat(e)).join("&"):"".concat(t,"=").concat(d[t])).join("&"))):"")+(l.hash?"#".concat(l.hash):"")),i.open(c,e,!0),n.withCredentials&&(i.withCredentials=!0),X(n.customHeaders,(e,t)=>{i.setRequestHeader(t,e)}),n.preflight&&i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.setRequestHeader("Content-Type",n.contentType||"text/plain"),"POST"===c&&s?i.send(s):i.send()}catch(t){o.error("ajax","xhr construction",t)}var l,d,h,u,g}(e,{success:function(e){o.info("Success at fetch call:",e),r.record(null===a||void 0===a?void 0:a.fetchSuccessfulCallTimer());try{t(c._validateResponse(e))}catch(e){i(e)}},error:function(e){r.record(null===a||void 0===a?void 0:a.fetchFailureCallTimer()),i(e)}},JSON.stringify({requests:s}),{method:"POST",withCredentials:!0},o)})})}_validateResponse(e){if(!e||!d(e)||e.length<1)throw new Error('Empty fetch response from ID5 servers: "'.concat(e,'"'));var t=JSON.parse(e);if(i(t.generic))return this._log.info("Valid json response from ID5 received",t),t;throw new Error("Server response failed to validate: ".concat(e))}_createRequest(e,i,t,r,s,n,o){this._log.info("Create request data for",{fetchIdData:i,consentData:e,signature:t,nbValue:r,refreshInSecondUsed:s,extensions:n});var a=i.partnerId;const c={requestId:i.integrationId,requestCount:i.requestCount,role:i.role,cacheId:i.cacheId,refresh:i.refresh,partner:a,v:i.originVersion,o:i.origin,tml:null==(a=i.refererInfo)?void 0:a.topmostLocation,ref:null==(a=i.refererInfo)?void 0:a.ref,cu:null==(a=i.refererInfo)?void 0:a.canonicalUrl,u:(null==(a=i.refererInfo)?void 0:a.stack[0])||window.location.href,top:null!=(a=i.refererInfo)&&a.reachedTop?1:0,localStorage:!0===o?1:0,nbPage:r,id5cdn:i.isUsingCdn,ua:window.navigator.userAgent,att:i.att};return f(r=e.gdprApplies)&&(c.gdpr=r?1:0),f(r=e.consentString)&&(c.gdpr_consent=r),f(i.allowedVendors)?c.allowed_vendors=i.allowedVendors:f(e.allowedVendors)&&(c.allowed_vendors=e.allowedVendors),f(e.gppData)&&(c.gpp_string=e.gppData.gppString,c.gpp_sid=e.gppData.applicableSections.join(",")),f(t)&&(c.s=t),f(t=i.uaHints)&&(c.ua_hints=t),f(e.ccpaString)&&""!==e.ccpaString&&(c.us_privacy=e.ccpaString),function(e){var t=Object.keys(e);let i=t.length,r=new Array(i);for(;i--;)r[i]=[t[i],e[t[i]]];return r}({pd:"pd",partnerUserId:"puid",provider:"provider",segments:"segments"}).forEach(e=>{var e=(t=v(e,2))[0],t=t[1];f(i[e])&&(c[t]=i[e])}),(e=i.abTesting)&&!0===e.enabled&&(c.ab_testing={enabled:!0,control_group_pct:e.controlGroupPct}),(e=i.invalidSegmentsCount)&&0<e&&(c._invalid_segments=e),i.trace&&(c._trace=!0),c.provided_options={refresh_in_seconds:i.providedRefreshInSeconds},c.used_refresh_in_seconds=s,c.extensions=n,c}}class We{constructor(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;c(this,"consentData",void 0),c(this,"refreshedResponse",void 0),this.consentData=e,this.refreshedResponse=t}}class He{constructor(e,t,i,r,s){s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new Ge(s,i,r),c(this,"_store",void 0),c(this,"_consentManager",void 0),c(this,"_uidRefresher",void 0),c(this,"_metrics",void 0),c(this,"_log",void 0),this._store=t,this._consentManager=e,this._metrics=i,this._log=r,this._uidRefresher=s}getId(o){let a=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];const c=this._log,l=(c.info("UidFetcher: requested to get an id:",o),this._store),d=this._consentManager,e=this._metrics,h=(c.info("Waiting for consent"),e.timer("fetch.consent.wait.time"));return d.getConsentData().then(t=>{c.info("Consent received",t),h&&h.recordNow();var e=d.localStorageGrant("fetcher-before-request");if(c.info("Local storage grant",e),!e.allowed)throw c.info("No legal basis to use ID5",t),new ee(t,"No legal basis to use ID5");var i=fe.checkIfAccessible(),r=l.hasConsentChanged(t);if(e.isDefinitivelyAllowed()&&l.storeConsent(t),r||a){c.info("Decided to fetch a fresh ID5 ID",{consentHasChanged:r,refreshRequired:a});const s=this._collectCacheData(o),n=this;return c.info("Fetching ID5 ID (forceFetch:".concat(a,")")),this._uidRefresher.refreshUid(o,t,s,i).then(e=>n._handleSuccessfulFetchResponse(e,o,t,s))}return c.info("Not decided to refresh ID5 ID",{consentHasChanged:r,refreshRequired:a}),new We(t,void 0)})}_handleSuccessfulFetchResponse(e,t,i,r){var s=this._log,n=this._consentManager,o=this._store,a=new Ve(e),e=(n.setStoredPrivacy(e.generic.privacy),n.localStorageGrant("fetcher-after-response"));return e.isDefinitivelyAllowed()?(s.info("Storing ID and request hashes in cache"),o.updateNbs(r),o.storeResponse(t,a)):(s.info("Cannot use local storage to cache ID",e),o.clearAll(t)),new We(i,a)}_collectCacheData(e){var t,i=new Map,r=u(e);try{for(r.s();!(t=r.n()).done;){var s,n=t.value.cacheId;i.has(n)||(s=this._store.getCachedResponse(n))&&i.set(n,s)}}catch(e){r.e(e)}finally{r.f()}return i}}class qe{constructor(e,t,i,r){c(this,"localStorageGrantChecker",void 0),c(this,"localStorage",void 0),c(this,"_log",void 0),this.localStorageGrantChecker=e,this.localStorage=t,this.storageConfig=i,this._log=r}get(e){var t=this._log;try{var i,r=this.localStorageGrant();if(r.isDefinitivelyAllowed())return i=this.localStorage.getItemWithExpiration(e),t.info("Local storage get key=".concat(e.name," value=").concat(i)),i;t.warn("clientStore.get() has been called without definitive grant",r)}catch(e){t.error(e)}}_getObject(e){var t=this._log;try{var i,r=this.localStorageGrant();if(r.isDefinitivelyAllowed())return i=this.localStorage.getObjectWithExpiration(e),t.info("Local storage get key=".concat(e.name," value=").concat(i)),i;t.warn("clientStore.get() has been called without definitive grant",r)}catch(e){t.error(e)}}clear(e){var t=this._log;try{this.localStorage.removeItemWithExpiration(e)}catch(e){t.error(e)}}scheduleGC(t){const i=this.localStorageGrant(),r=this.localStorage,s=this.storageConfig.ID5_V2.name;setTimeout(function(){var e;i.isDefinitivelyAllowed()&&(e=r.removeExpiredObjectWithPrefix(s),t.storageAllKeysCounter().record((null==e?void 0:e.all)||0),t.storageExpiredKeysCounter().record((null==e?void 0:e.expired)||0))},0)}_clearObject(e){var t=this._log;try{this.localStorage.removeItem(e.name)}catch(e){t.error(e)}}_put(e,t){var i=this._log;try{var r=this.localStorageGrant();r.isDefinitivelyAllowed()?(i.info("Local storage put key=".concat(e.name," value=").concat(t)),this.localStorage.setItemWithExpiration(e,t)):i.warn("clientStore._put() has been called without definitive grant",r)}catch(e){i.error(e)}}_updateObject(e,t){var i=this._log;try{var r=this.localStorageGrant();if(r.isDefinitivelyAllowed())return this.localStorage.updateObjectWithExpiration(e,t);i.warn("clientStore._updateObject() has been called without definitive grant",r)}catch(e){i.error(e)}}localStorageGrant(){return this.localStorageGrantChecker()}getResponse(){var e=this.get(this.storageConfig.ID5);return e&&JSON.parse(decodeURIComponent(e))}clearResponse(){this.clear(this.storageConfig.ID5)}clearResponseV2(e){this._clearObject(this.storageConfig.ID5_V2.withNameSuffixed(e))}putResponseV1(e){this._put(this.storageConfig.ID5,encodeURIComponent(d(e)?e:JSON.stringify(e)))}getHashedConsentData(){return this.get(this.storageConfig.CONSENT_DATA)}clearHashedConsentData(){this.clear(this.storageConfig.CONSENT_DATA)}putHashedConsentData(e){e!==new I&&this._put(this.storageConfig.CONSENT_DATA,e.hashCode())}static makeStoredHash(e){return $("string"==typeof e?e:"")}getDateTime(){return new Date(this.get(this.storageConfig.LAST)).getTime()}clearDateTime(){this.clear(this.storageConfig.LAST)}setResponseDateTimeV1(e){this._put(this.storageConfig.LAST,e)}storeResponseV2(e,t){let i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Date.now();return this._updateObject(this.storageConfig.ID5_V2.withNameSuffixed(e),e=>h(h({},e),{},{response:t,responseTimestamp:i}))}getStoredResponseV2(e){return this._getObject(this.storageConfig.ID5_V2.withNameSuffixed(e))}incNbV2(e){let i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;return this._updateObject(this.storageConfig.ID5_V2.withNameSuffixed(e),e=>{var t=Math.max(0,Q(null==e?void 0:e.nb)?Math.round(e.nb)+i:i);return h(h({},e),{},{nb:t})})}static storedDataMatchesCurrentData(e,t){return null==e||e===t}storedConsentDataMatchesConsentData(e){return qe.storedDataMatchesCurrentData(this.getHashedConsentData(),e.hashCode())}}class E{constructor(e,t){c(this,"_metrics",void 0),c(this,"_log",void 0),this._metrics=e,this._log=t}static getChunkUrl(e,t){return"https://c".concat(e,".eu-").concat(t,"-id5-sync.com")}submitExtensionCall(t,i){let r=b();return fetch(t).then(e=>e.ok?(r.record(this._metrics.extensionsCallTimer(i,!0)),e.json()):(r.record(this._metrics.extensionsCallTimer(i,!1)),e="The call to get extensions at ".concat(t," was not ok, status: ").concat(e.status,", statusText: ").concat(e.statusText),this._log.warn(e),Promise.reject(new Error(e)))).catch(e=>(r.record(this._metrics.extensionsCallTimer(i,!1)),this._log.warn("Got error from ".concat(t," endpoint"),e),{}))}gatherChunks(e,i){if(e){let t=b();return Promise.all(Array.from({length:i.length},(e,t)=>(t=E.getChunkUrl(t,i.urlVersion),fetch(t).then(e=>{if(e.ok)return e.text();throw new Error("The call to get ".concat(i.name," was not ok, status: ").concat(e.status,", statusText: ").concat(e.statusText))})))).then(e=>(t.record(this._metrics.extensionsCallTimer(i.name,!0)),{[i.name]:e,[i.name+"Version"]:"".concat(i.version)})).catch(e=>(t.record(this._metrics.extensionsCallTimer(i.name,!1)),this._log.warn("Got error when getting ".concat(i.name),e),{}))}return Promise.resolve({})}gather(i){let r=b();return this.submitExtensionCall("https://lb.eu-1-id5-sync.com/lb/v1","lb").then(e=>{var t=this.getChunksEnabled(i,e);return Promise.allSettled([Promise.resolve(e),this.gatherChunks(t,E.CHUNKS_CONFIGS.devChunks),this.gatherChunks(t,E.CHUNKS_CONFIGS.groupChunks)])}).then(e=>{r.record(this._metrics.extensionsCallTimer("all",!0));let t=E.DEFAULT_RESPONSE;return e.forEach(e=>{e.value&&(t=h(h({},t),e.value))}),t}).catch(e=>(r.record(this._metrics.extensionsCallTimer("all",!1)),this._log.error("Got error ".concat(e," when gathering extensions data")),E.DEFAULT_RESPONSE))}getChunksEnabled(e,t){return e=e.some(e=>e.pd&&""!==e.pd.trim()),0!==(t=null==t?void 0:t.chunks)&&(e||t)}}c(E,"CHUNKS_CONFIGS",Object.freeze({devChunks:{name:"devChunks",urlVersion:3,length:8,version:4},groupChunks:{name:"groupChunks",urlVersion:4,length:8,version:4}})),c(E,"DEFAULT_RESPONSE",{lbCDN:"%%LB_CDN%%"});const Je={createExtensions:function(e,t){return new E(e,t)}},A=Object.freeze({UNKNOWN:"unknown",LEADER:"leader",FOLLOWER:"follower"}),O=Object.freeze({MULTIPLEXING:"multiplexing",SINGLETON:"singleton"}),P=Object.freeze({AWAITING_SCHEDULE:"awaiting_schedule",SKIPPED:"skipped",SCHEDULED:"scheduled",COMPLETED:"completed",CANCELED:"canceled"});class Be{constructor(e,t,i){c(this,"properties",void 0),c(this,"knownState",void 0),c(this,"_joinTime",void 0),c(this,"_window",void 0),this.properties=e,this.knownState=t,this._window=i,this._joinTime=performance.now()}getId(){return this.properties.id}isMultiplexingPartyAllowed(){var e;return(null==(e=this.knownState)?void 0:e.operatingMode)===O.MULTIPLEXING}getInstanceMultiplexingLeader(){var e;return(null==(e=this.knownState)?void 0:e.operatingMode)!==O.MULTIPLEXING||null==(e=this.knownState)||null==(e=e.multiplexing)?void 0:e.leader}getWindow(){return this._window}}class Ke{constructor(e){c(this,"_knownValues",[]),c(this,"_counter",void 0),this._counter=e}add(e){e&&-1===this._knownValues.indexOf(e)&&(this._counter.inc(),this._knownValues.push(e))}}class Ye{constructor(e,t){c(this,"_instancesCounter",void 0),c(this,"_domainsCounter",void 0),c(this,"_windowsCounter",void 0),c(this,"_partnersCounter",void 0);var i=t.id;this._instancesCounter=e.instanceCounter(t.id),this._windowsCounter=new Ke(e.instanceUniqWindowsCounter(i)),this._partnersCounter=new Ke(e.instanceUniqPartnersCounter(i)),this._domainsCounter=new Ke(e.instanceUniqueDomainsCounter(i))}addInstance(e){var t;this._instancesCounter.inc(),this._partnersCounter.add((null==e||null==(t=e.fetchIdData)?void 0:t.partnerId)|(null==e||null==(t=e.sourceConfiguration)||null==(t=t.options)?void 0:t.partnerId)),this._domainsCounter.add(null==e?void 0:e.domain),this._windowsCounter.add(null==e?void 0:e.href)}}class ze{constructor(e){c(this,"_scheduleTime",void 0),c(this,"_closeTime",void 0),c(this,"_timeoutId",void 0),c(this,"_state",P.AWAITING_SCHEDULE),c(this,"_delayMs",void 0),c(this,"_instance",void 0),this._instance=e}schedule(e){const t=this;t._delayMs=e,this._timeoutId=setTimeout(()=>{t._timeoutId&&(t._timeoutId=void 0,t._instance._doElection(),t._closeWithState(P.COMPLETED))},t._delayMs),t._state=P.SCHEDULED,t._scheduleTime=performance.now()}skip(){this._closeWithState(P.SKIPPED)}cancel(){this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0),this._closeWithState(P.CANCELED)}_closeWithState(e){this._state=e,this._closeTime=performance.now()}}class Qe{constructor(e,t,i,r){var s,n=4<arguments.length&&void 0!==arguments[4]?arguments[4]:_,o=(c(this,"properties",void 0),c(this,"_messenger",void 0),c(this,"_knownInstances",new Map),c(this,"_lastJoinedInstance",void 0),c(this,"role",void 0),c(this,"_leader",void 0),c(this,"_mode",void 0),c(this,"_metrics",void 0),c(this,"_logger",void 0),c(this,"_instanceCounters",void 0),c(this,"_election",void 0),c(this,"_window",void 0),c(this,"_storage",void 0),f(globalThis)&&f(globalThis.crypto)&&l(globalThis.crypto.randomUUID)?globalThis.crypto.randomUUID():"".concat(1e6*Math.random()|0));this.properties=p({id:o,version:"1.0.22",href:null==(s=e.location)?void 0:s.href,domain:null==(s=e.location)?void 0:s.hostname},t),this.role=A.UNKNOWN,this._metrics=r,this._instanceCounters=new Ye(r,this.properties),this._loadTime=performance.now(),this._logger=void 0!==n?new G("Instance(id=".concat(o,")"),n):_,this._window=e,this._dispatcher=new ue(this._logger),this._leader=new le,this._followerRole=new Ce(this._window,this.properties,this._dispatcher,this._logger),this._election=new ze(this),this._storage=i}updateConfig(e){p(this.properties,e)}init(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1e3;let r=this,s=r._window;r._mode=!0===r.properties.singletonMode?O.SINGLETON:O.MULTIPLEXING,r._instanceCounters.addInstance(r.properties);{var i=r;const n=i._metrics;[100,200,500,1e3,2e3,3e3,5e3].forEach(t=>{setTimeout(()=>{var e=((null==(e=i._knownInstances)?void 0:e.size)||0)+1;n.summary("instance.partySize",{after:t,electionState:i._election._state}).record(e)},t)})}r._messenger=new J(r.properties.id,s,r._logger),r._messenger.onAnyMessage((e,t)=>{var i=Date.now()-e.timestamp|0;r._metrics.instanceMsgDeliveryTimer({messageType:e.type,sameWindow:s===t}).record(i),r._logger.debug("Message received",e),r._doFireEvent(de.ID5_MESSAGE_RECEIVED,e)}).onMessage(o.TYPE,(e,t)=>{var i=p(new o,e.payload);void 0===i.isResponse&&(i.isResponse=void 0!==e.dst),r._handleHelloMessage(i,e,t)}).onProxyMethodCall(new q(this._logger).registerTarget(a.LEADER,r._leader).registerTarget(a.FOLLOWER,r._followerRole).registerTarget(a.STORAGE,r._storage)),r._mode===O.SINGLETON?(r._election.skip(),r._onLeaderElected(r.properties)):r._mode===O.MULTIPLEXING&&r._election.schedule(e),r._messenger.broadcastMessage(r._createHelloMessage(!1),o.TYPE)}register(e){try{this.updateConfig(e),this.init()}catch(e){this._logger.error("Failed to register integration instance",e)}return this}_handleHelloMessage(e,t,i){this._joinInstance(e,t,i)}unregister(){this._logger.info("Unregistering"),this._messenger&&this._messenger.unregister()}on(e,t){return this._dispatcher.on(e,t),this}_joinInstance(e,t,i){var r=e.isResponse,e=new Be(e.instance,e.instanceState,i);this._knownInstances.get(e.getId())?this._logger.debug("Instance already known",e.getId()):(this._knownInstances.set(e.getId(),e),this._lastJoinedInstance=e,this._instanceCounters.addInstance(e.properties),this._metrics.instanceJoinDelayTimer({election:this._election._state}).record(performance.now()-this._loadTime|0),r?(r=e.getInstanceMultiplexingLeader(),this._mode===O.MULTIPLEXING&&this.role===A.UNKNOWN&&void 0!==r&&(this._logger.info("Joined late, elected leader is",r),this._election.cancel(),this._onLeaderElected(r))):(this._messenger.sendResponseMessage(t,this._createHelloMessage(!0),o.TYPE),this._mode===O.MULTIPLEXING&&this.role!==A.UNKNOWN&&this._handleLateJoiner(e)),this._logger.debug("Instance joined",e.getId()),this._doFireEvent(de.ID5_INSTANCE_JOINED,e.properties))}_createHelloMessage(){var e,t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],i={operatingMode:this._mode,knownInstances:Array.from(this._knownInstances.values()).map(e=>e.properties)};return this._mode===O.MULTIPLEXING&&(i.multiplexing={role:this.role,electionState:null==(e=this._election)?void 0:e._state,leader:this._leader.getProperties()}),new o(this.properties,t,i)}_handleLateJoiner(e){this._logger.info("Late joiner detected",e.properties);var t=this._metrics.instanceLateJoinCounter(this.properties.id,{scope:"party"}).inc();this._metrics.instanceLateJoinDelayTimer({election:this._election._state,isFirst:1===t}).record(performance.now()-this._election._closeTime),e.isMultiplexingPartyAllowed()&&this.role===A.LEADER&&!0===(null==(e=this._leader.addFollower(new Se(e,this._messenger,this._logger)))?void 0:e.lateJoiner)&&this._metrics.instanceLateJoinCounter(this.properties.id,{scope:"leader",unique:!0===(null==e?void 0:e.uniqueLateJoiner)}).inc()}_doFireEvent(e){for(var t=arguments.length,i=new Array(1<t?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];this._dispatcher.emit(e,...i)}_actAsLeader(){var e=this.properties;const t=this._logger;var i=this._metrics,r=new me(this._storage),s=new pe(r),n=new y(e.storageExpirationDays);const o=new be(s,n,e.forceAllowLocalStorageGrant,t,i),a=(s=new re(new qe(()=>o.localStorageGrant("client-store"),s,n,t)),n=new He(o,s,i,t,Je.createExtensions(i,t)),new ae(this._window,e,r,s,o,i,t,n));a.addFollower(this._followerRole),this._leader.assignLeader(a),this._mode===O.MULTIPLEXING&&Array.from(this._knownInstances.values()).filter(e=>e.isMultiplexingPartyAllowed()).map(e=>a.addFollower(new Se(e,this._messenger,t))),a.start()}_followRemoteLeader(e){this._leader.assignLeader(new ce(this._messenger,e)),this._logger.info("Following remote leader ",e)}updateConsent(e){this._leader.updateConsent(e)}updateFetchIdData(e){this._leader.updateFetchIdData(this.properties.id,e),p(this.properties.fetchIdData,e)}refreshUid(e){this._leader.refreshUid(e,this.properties.id)}_doElection(){var e=this._election,t=this._knownInstances,t=Array.from(t.values()).filter(e=>e.isMultiplexingPartyAllowed()).map(e=>e.properties),t=(t.push(this.properties),this._onLeaderElected(function(e){if(e&&0!==e.length)return(e=e.sort((e,t)=>{let i=-B(e.version,t.version);return i=0===i&&0===(i=0===(i=e.source.localeCompare(t.source))?-B(e.sourceVersion,t.sourceVersion):i)?e.id.localeCompare(t.id):i}))[0]}(t)),this._lastJoinedInstance);t&&this._metrics.instanceLastJoinDelayTimer().record(Math.max(t._joinTime-e._scheduleTime,0))}_onLeaderElected(e){var t=this;t.role=e.id===t.properties.id?A.LEADER:A.FOLLOWER,t.role===A.LEADER?t._actAsLeader():t.role===A.FOLLOWER&&t._followRemoteLeader(e),t._logger.debug("Leader elected",e.id,"my role",t.role),t._doFireEvent(de.ID5_LEADER_ELECTED,t.role,t._leader.getProperties())}getId(){return this.properties.id}}const T=Object.freeze({cmp:"cmp",partner:"partner",prebid:"prebid"}),Xe=new class{createInstance(e,t,i,r){return new Qe(e,{},r,i,t)}},$e="TRUE"===nt("id5_debug").toUpperCase(),Ze="TRACE"===nt("id5_debug").toUpperCase(),et=Boolean(window.console);let tt=!1;function it(e,t,i,r,s){rt()&&et&&e&&e.apply(console,["%cID5 - ".concat(t,"#").concat(i),"color: #fff; background: #1c307e; padding: 1px 4px; border-radius: 3px;",r].concat(s))}function rt(){return $e||Ze||tt}class st extends e{constructor(e,t){super(),c(this,"_invocationId",void 0),c(this,"_origin",void 0),this._invocationId=t,this._origin=e}debug(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];!function(e,t){for(var i=arguments.length,r=new Array(2<i?i-2:0),s=2;s<i;s++)r[s-2]=arguments[s];it(console.info,e,t,"DEBUG",r)}(this._origin,this._invocationId,...t)}info(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];!function(e,t){for(var i=arguments.length,r=new Array(2<i?i-2:0),s=2;s<i;s++)r[s-2]=arguments[s];it(console.info,e,t,"INFO",r)}(this._origin,this._invocationId,...t)}warn(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];!function(e,t){for(var i=arguments.length,r=new Array(2<i?i-2:0),s=2;s<i;s++)r[s-2]=arguments[s];it(console.warn,e,t,"WARNING",r)}(this._origin,this._invocationId,...t)}error(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];!function(e,t){for(var i=arguments.length,r=new Array(2<i?i-2:0),s=2;s<i;s++)r[s-2]=arguments[s];it(console.error,e,t,"ERROR",r)}(this._origin,this._invocationId,...t)}}function nt(e){e=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.search);return null===e?"":decodeURIComponent(e[1].replace(/\+/g," "))}function ot(e){return t(e,"Boolean")}const at=t,R=l,x=d,ct=g,lt=Q,U=i,dt=f;function ht(e){(new Image).src=e}function ut(e,t,i,r,s){for(t=t.split?t.split("."):t,r=0;r<t.length;r++)e=e?e[t[r]]:s;return e===s?i:e}new st("ajax");function gt(){try{var i=function(){var i=function(){let t=[],i;do{try{i=i?i.parent:D;try{var r=i===D.top;let e={referrer:i.document.referrer||null,location:i.location.href||null,isTop:r};r&&(e=p(e,{canonicalUrl:function(e){try{var t=e.querySelector("link[rel='canonical']");if(null!==t)return t.href}catch(e){}return null}(i.document)})),t.push(e)}catch(e){t.push({referrer:null,location:null,isTop:i===D.top})}}catch(e){return t.push({referrer:null,location:null,isTop:!1}),t}}while(i!==D.top);return t}();var r=function(){try{return D.location.ancestorOrigins||void 0}catch(e){}}();if(r)for(let e=0,t=r.length;e<t;e++)i[e].ancestor=r[e];return i}(),r=i.length-1,s=null!==i[r].location||0<r&&null!==i[r-1].referrer,n=function(e){var t,i=[];let r=null,s=null,n=null,o=null,a;for(a=e.length-1;0<=a;a--){try{r=e[a].location}catch(e){}if(r)i.push(r),o=o||r;else if(0!==a){t=e[a-1];try{s=t.referrer,n=t.ancestor}catch(e){}s?(i.push(s),o=o||s):n?(i.push(n),o=o||n):i.push(null)}else i.push(null)}return{stack:i,detectedRefererUrl:o}}(i);let e,t;i[i.length-1].canonicalUrl&&(e=i[i.length-1].canonicalUrl);try{t=D.top.document.referrer}catch(e){}return{topmostLocation:n.detectedRefererUrl,ref:t||null,reachedTop:s,numIframes:r,stack:n.stack,canonicalUrl:e}}catch(e){}}const pt=e=>null!=e&&"object"==typeof e;D=window;const vt={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,a:26,b:27,c:28,d:29,e:30,f:31,g:32,h:33,i:34,j:35,k:36,l:37,m:38,n:39,o:40,p:41,q:42,r:43,s:44,t:45,u:46,v:47,w:48,x:49,y:50,z:51,0:52,1:53,2:54,3:55,4:56,5:57,6:58,7:59,8:60,9:61,"-":62,_:63,"+":62,"/":63},_t=Object.freeze({tcfv2:{objName:"__tcfapiCall",objKeys:["command","version"],returnObjName:"__tcfapiReturn"},uspv1:{objName:"__uspapiCall",objKeys:["command","version"],returnObjName:"__uspapiReturn"},gppv1:{objName:"__gppCall",objKeys:["command","parameter"],returnObjName:"__gppReturn"}}),ft=Object.freeze({TCF:0,USP:1,GPP:2});class N{constructor(e,t){c(this,"direct",void 0),c(this,"version",void 0),this.direct=e,this.version=t}getConsentData(){var e=this;return n(function*(){return e.getClientConsentData()})()}static create(a){return n(function*(){var e=(t=k._findCmpApi("__gpp")).cmpApiFrame,t=t.cmpApiFunction;let i,r=!1;if(!e)return a.warn("cmpApi: GPP not found! Using defaults."),Promise.resolve();if(R(t))r=!0,a.info("cmpApi: Detected GPP is directly accessible, calling it now."),i=t;else{a.info("cmpApi: Detected GPP is outside the current iframe. Using message passing.");const o=k._buildCmpSurrogate(_t.gppv1,e);i=function(e,t,i){o(e,i,t)}}var s=yield new Promise(t=>{var e=i("ping",function(e){t(e)});e&&t(e)});switch(s.gppVersion){case mt.version:return new mt(s,i,r);case It.version:return new It(s,i,r);default:var n="Unsupported version of gpp: ".concat(s.gppVersion);return a.warn(n),Promise.reject(n)}})()}static tcfDataHasLocalStorageGrant(e){return ct(e.PurposeConsent)&&!0===e.PurposeConsent[0]&&0<=(null==(e=e.VendorConsent)?void 0:e.indexOf("131"))}}class mt extends N{constructor(e,t,i){super(i,mt.version),c(this,"gppFn",void 0),c(this,"ready",void 0),this.gppFn=t,this.ready=this.isReady(e)}isReady(e){return"loaded"===e.cmpStatus&&"visible"!==e.cmpDisplayStatus}getClientConsentData(){var r=this;return n(function*(){r.ready||(r.ready=yield new Promise(t=>{r.gppFn("addEventListener",e=>!!r.isReady(e.pingData)&&void t(!0))}));var e=new Promise(t=>{r.gppFn("getGPPData",e=>{t(e)})}),t=new Promise(t=>{r.gppFn("getSection",e=>{t(e)},"tcfeuv2")}),t=(e=v(yield Promise.all([e,t]),2))[0],e=e[1],i=new te;return i.version=m.GPP_V1_0,i.gppString=t.gppString,i.applicableSections=t.applicableSections,e&&(i.localStoragePurposeConsent=N.tcfDataHasLocalStorageGrant(e)),i})()}}c(mt,"version","1.0");class It extends N{constructor(e,t,i){super(i,It.version),c(this,"gppFn",void 0),c(this,"readyPingData",void 0),this.gppFn=t,"ready"===e.signalStatus&&(this.readyPingData=e)}getClientConsentData(){var i=this;return n(function*(){return new Promise(t=>{i.readyPingData?t(i.parsePingData(i.readyPingData)):i.gppFn("addEventListener",e=>"ready"===e.pingData.signalStatus&&void t(i.parsePingData(e.pingData)))})})()}parsePingData(e){var t=new te;return t.gppString=e.gppString,t.version=m.GPP_V1_1,t.applicableSections=e.applicableSections,(e=null==(e=e.parsedSections)?void 0:e.tcfeuv2)&&(t.localStoragePurposeConsent=N.tcfDataHasLocalStorageGrant(e[0])),t}}c(It,"version","1.1");class k{constructor(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:_;c(this,"_lookupInProgress",void 0),c(this,"_log",void 0),c(this,"_metrics",void 0),c(this,"_consentDataPromise",void 0),this._metrics=e,this._log=t}refreshConsentData(e,t,i){const r=this;return r._lookupInProgress||(r._lookupInProgress=!0,r._consentDataPromise=this._lookupConsentData(e,t,i).finally(()=>{r._lookupInProgress=!1})),this._consentDataPromise}_lookupConsentData(e,t,i){if(e)return this._log.warn("cmpApi: ID5 is operating in forced consent mode and will not retrieve any consent signals from the CMP"),(e=new I).forcedGrantByConfig=!0,e.source=T.partner,Promise.resolve(e);switch(t){case"static":return new Promise(e=>{this._parseStaticConsentData(i,e)});case"iab":return new Promise(e=>{this._lookupIabConsent(e)});default:return this._log.error("cmpApi: Unknown consent API: ".concat(t)),Promise.reject(new Error("Unknown consent API: ".concat(t)))}}_parseStaticConsentData(e,t){e=e||{};var i=new I;i.source=T.partner;let r={};if(U(e.getTCData)){r=this._parseTcfData(e.getTCData);try{const s=this._metrics;this._lookupTcf(e=>{var t;s.consentDiscrepancyCounter({apiType:m.TCF_V2,sameString:(null==e?void 0:e.consentString)===(null==(t=r)?void 0:t.consentString),sameLSPC:(null==e?void 0:e.localStoragePurposeConsent)===(null==(t=r)?void 0:t.localStoragePurposeConsent),sameGdpr:(null==e?void 0:e.gdprApplies)===(null==(t=r)?void 0:t.gdprApplies),sameApi:(null==e?void 0:e.api)===(null==(e=r)?void 0:e.api)}).inc()})}catch(e){}}else if(ct(e.allowedVendors))r={api:m.ID5_ALLOWED_VENDORS,allowedVendors:e.allowedVendors.map(e=>e.toString()),gdprApplies:!0};else if(U(e.getUSPData)){r=this._parseUspData(e.getUSPData);try{const n=this._metrics;this._lookupUsp(e=>{var t;n.consentDiscrepancyCounter({apiType:m.USP_V1,sameString:(null==e?void 0:e.ccpaString)===(null==(t=r)?void 0:t.ccpaString),sameApi:(null==e?void 0:e.api)===(null==(e=r)?void 0:e.api)}).inc()})}catch(e){}}else this._log.warn("cmpApi: No static consent data detected! Using defaults.");p(i,r),this._log.info("cmpApi: Detected API '".concat(i.api,"' from static consent data"),e),t(i)}_lookupIabConsent(i){const r=[];let s=new I;s.source=T.cmp;var e=(n=t=>(r[t]=0,e=>{r[t]||(r[t]=Date.now(),e&&p(s,e),r.every(e=>0<e)&&i(s))}))(ft.TCF),t=n(ft.USP),n=n(ft.GPP);this._lookupGpp(n),this._lookupTcf(e),this._lookupUsp(t)}_lookupUsp(i){var e=(t=k._findCmpApi("__uspapi")).cmpApiFrame,t=t.cmpApiFunction;e?(R(t)?(this._log.info("cmpApi: Detected USP is directly accessible, calling it now."),t):(this._log.info("cmpApi: Detected USP is outside the current iframe. Using message passing."),k._buildCmpSurrogate(_t.uspv1,e)))("getUSPData",1,(e,t)=>{t?i(this._parseUspData(e)):(this._log.error("cmpApi: USP callback not successful. Using defaults for CCPA."),i())}):(this._log.warn("cmpApi: USP not found! Using defaults for CCPA."),i())}_lookupGpp(o){var a=this;return n(function*(){var e=Date.now();try{var t=yield N.create(a._log);if(t){var i={gppVersion:t.version,directCmp:t.direct};try{var r=yield t.getConsentData(),s={api:r.version,gppData:r},n=(o(s),Date.now());a._metrics.timer("gpp.delay",i).record(n-e)}catch(e){a._metrics.counter("gpp.failure",p({type:"CONSENT"},i)).inc(),a._log.error("cmpApi: getting GPP consent not successful. Using defaults for Gpp."),o()}}else o()}catch(e){a._metrics.counter("gpp.failure",{type:"CLIENT"}).inc(),a._log.error("cmpApi: creating GPP client not successful. Using defaults for Gpp."),o()}})()}static _buildCmpSurrogate(a,c){return(e,t,i)=>{const r=Math.random()+"",s={},n={},o=(n[a.objKeys[0]]=e,n[a.objKeys[1]]=t,n.callId=r,s[a.objName]=n,e=>{!(e=ut(e,"data.".concat(a.returnObjName)))||e.callId!==r||void 0!==(e=i(e.returnValue,e.success))&&!0!==e||window.removeEventListener("message",o)});window.addEventListener("message",o,!1),c.postMessage(s,"*")}}_lookupTcf(e){var t=(i=k._findTCF()).cmpFrame,i=i.cmpFunction;t?R(i)?this._lookupDirectTcf(i,e):(this._log.info("cmpApi: Detected TCF is outside the current iframe. Using message passing."),this._lookupMessageTcf(t,e)):(this._log.warn("cmpApi: TCF not found! Using defaults for GDPR."),e())}_lookupMessageTcf(e,t){e=k._buildCmpSurrogate(_t.tcfv2,e),this._lookupDirectTcf(e,t)}_lookupDirectTcf(e,r){const s=this._log;e("addEventListener",2,(e,t)=>{var i=e;return s.info("cmpApi: TCFv2 - Received a call back: ".concat("event"),i),t?!(!e||!1!==e.gdprApplies&&"tcloaded"!==e.eventStatus&&"useractioncomplete"!==e.eventStatus)&&void r(this._parseTcfData(e)):(s.error("cmpApi: TCFv2 - Received insuccess: ".concat("addEventListener",". Please check your CMP setup. Using defaults for GDPR.")),void r())})}_parseUspData(e){if(U(e)&&x(e.uspString))return{api:m.USP_V1,ccpaString:e.uspString};this._log.error("cmpApi: No or malformed USP data. Using defaults for CCPA.")}_parseTcfData(e){var t=this._log,i=k._isValidV2ConsentObject,r=k._normalizeV2Data;if(i(e))return r(e);t.error("cmpApi: Invalid CMP data. Using defaults for GDPR.",e)}static _isValidV2ConsentObject(e){var t=e&&e.gdprApplies,e=e&&e.tcString;return!1===t||x(e)}static _normalizeV2Data(e){let t=ut(e,"purpose.consents.1");return ot(t)||(t=function(e,t){if(e&&"C"===e.charAt(0)&&!(e.length<=25)&&(t=e.charAt(25),void 0!==(t=vt[t])))return 0!=(8&t)}(e.tcString)),{consentString:e.tcString,localStoragePurposeConsent:t,gdprApplies:e.gdprApplies,api:m.TCF_V2}}static _findTCF(){let e=window,t,i;for(;!t;){try{if("function"==typeof e.__tcfapi){i=e.__tcfapi,t=e;break}}catch(e){}try{if(e.frames.__tcfapiLocator){t=e;break}}catch(e){}if(e===window.top)break;e=e.parent}return{cmpFrame:t,cmpFunction:i}}static _findCmpApi(e){let t=window,i,r;for(;!i;){try{if("function"==typeof t[e]){r=t[e],i=t;break}}catch(e){}try{if(t.frames["".concat(e,"Locator")]){i=t;break}}catch(e){}if(t===window.top)break;t=t.parent}return{cmpApiFrame:i,cmpApiFunction:r}}}const wt="1.0.62";class Ct{static gatherUaHints(e,t){return n(function*(){if(f(window.navigator.userAgentData)&&!e){let e;try{e=yield window.navigator.userAgentData.getHighEntropyValues(["architecture","fullVersionList","model","platformVersion"])}catch(e){return void t.error("Error while calling navigator.userAgentData.getHighEntropyValues()",e)}return Ct.filterUaHints(e)}})()}static filterUaHints(e){if(f(e)){const t=/[()-.:;=?_/]/g;return g(e.brands)&&(e.brands=e.brands.filter(e=>d(e.brand)&&e.brand.search(t)<0)),g(e.fullVersionList)&&(e.fullVersionList=e.fullVersionList.filter(e=>d(e.brand)&&e.brand.search(t)<0)),e}}}const L=Object.freeze({NEVER:"never",AFTER_UID_SET:"after-uid-set",ASAP:"asap"}),yt=Object.freeze({allowGCReclaim:Object.values(L)});class St{constructor(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:_;if(c(this,"invocationId",void 0),c(this,"options",void 0),c(this,"providedOptions",void 0),c(this,"invalidSegments",void 0),this._log=t,this.options={debugBypassConsent:!1,allowLocalStorageWithoutConsentApi:!1,cmpApi:"iab",consentData:{},refreshInSeconds:7200,partnerId:void 0,partnerUserId:void 0,callbackOnAvailable:void 0,callbackOnUpdates:void 0,callbackTimeoutInMs:void 0,pd:void 0,abTesting:{enabled:!1,controlGroupPct:0},provider:void 0,maxCascades:8,applyCreativeRestrictions:!1,acr:!1,segments:void 0,disableUaHints:!1,storageExpirationDays:void 0,att:void 0,diagnostics:{publishingDisabled:!1,publishAfterLoadInMsec:3e4,publishBeforeWindowUnload:!0,publishingSampleRatio:.01},multiplexing:{_disabled:!1},allowGCReclaim:L.AFTER_UID_SET},this.providedOptions={},!lt(e.partnerId)&&!x(e.partnerId))throw new Error("partnerId is required and must be a number or a string");this.invalidSegments=0,this.updOptions(e),this.storageConfig=new y(e.storageExpirationDays)}getOptions(){return this.options}getProvidedOptions(){return this.providedOptions}getInvalidSegments(){return this.invalidSegments}hasCreativeRestrictions(){return this.options.applyCreativeRestrictions||this.options.acr}updOptions(a){const c=this,l=c._log;if(U(a)){this.setPartnerId(a.partnerId);const d=(e,t)=>{this.options[e]=t,this.providedOptions[e]=t};Object.keys(a).forEach(e=>{if("segments"===e){const r=a[e],s=[];f(r)&&(ct(r)?(r.forEach((e,t)=>(t="segments[".concat(t,"]"),ct(e.ids)&&function(e,t){let i=!0;return X(e,e=>i=i&&t(e)),i}(e.ids,x)?e.ids.length<1?(l.error("Config option ".concat(t,".ids should contain at least one segment ID")),void(c.invalidSegments+=1)):x(e.destination)?void s.push(e):(Dt(l,"".concat(t,".destination"),"String",e.destination),void(c.invalidSegments+=1)):(Dt(l,"".concat(t,".ids"),"Array of String",e.ids),void(c.invalidSegments+=1)))),d(e,s)):Dt(l,e,"Array",r))}else if("diagnostics"===e){const n=this.options.diagnostics,o=a.diagnostics;if(at(o,St.configTypes.diagnostics)){let t=h({},n);Object.keys(o).forEach(e=>{void 0!==n[e]&&typeof n[e]==typeof o[e]&&(t[e]=o[e])}),this.options[e]=t}this.providedOptions[e]=a[e]}else{var t,i;void 0!==yt[e]?(i=a[e])&&yt[e].includes(i)&&d(e,i):"partnerId"!==e&&(t=St.configTypes[e],f(i=a[e]))&&(at(i,t)?d(e,i):Dt(l,e,t,i))}})}else l.error("Config options must be an object")}setPartnerId(e){let t;if(x(e)){if(t=parseInt(e),isNaN(t)||t<0)throw new Error("partnerId is required and must parse to a positive integer")}else lt(e)&&(t=e);if(lt(t)){if(lt(this.options.partnerId)&&t!==this.options.partnerId)throw new Error("Cannot update config with a different partnerId");this.options.partnerId=t,this.providedOptions.partnerId=e}}}function Dt(e,t,i,r){e.error("Config option ".concat(t," must be of type ").concat(i," but was ").concat(toString.call(r),". Ignoring..."))}c(St,"configTypes",{debugBypassConsent:"Boolean",allowLocalStorageWithoutConsentApi:"Boolean",cmpApi:"String",consentData:"Object",refreshInSeconds:"Number",partnerUserId:"String",callbackOnAvailable:"Function",callbackOnUpdates:"Function",callbackTimeoutInMs:"Number",pd:"String",abTesting:"Object",provider:"String",maxCascades:"Number",applyCreativeRestrictions:"Boolean",acr:"Boolean",disableUaHints:"Boolean",storageExpirationDays:"Number",att:"Number",diagnostics:"Object",multiplexing:"Object",dynamicConfig:"Object",allowGCReclaim:"String"});class bt{constructor(e,t,i,r){c(this,"_called",void 0),c(this,"_callbackFn",void 0),c(this,"_callbackArgs",void 0),c(this,"_beforeTrigger",void 0),c(this,"_watchdog",void 0),this._callbackFn=e;for(var s=arguments.length,n=new Array(4<s?s-4:0),o=4;o<s;o++)n[o-4]=arguments[o];this._callbackArgs=n,this._beforeTrigger=r,this._called=!1,i?this._watchdog=setTimeout(()=>this._trigger(),0):0<t&&(this._watchdog=setTimeout(()=>this._trigger(),t))}_trigger(){this._watchdog=void 0,this._called||(this._called=!0,setTimeout(()=>{this._beforeTrigger(),this._callbackFn.call(globalThis,...this._callbackArgs)},0))}triggerNow(){this.disableWatchdog(),this._trigger()}disableWatchdog(){this._watchdog&&(clearTimeout(this._watchdog),this._watchdog=void 0)}}const Et="api";class At{constructor(e,t,i){c(this,"refererInfo",void 0),c(this,"apiVersion",void 0),c(this,"isUsingCdn",void 0),this.refererInfo=e,this.apiVersion=t,this.isUsingCdn=i}}class Ot{constructor(e,t){c(this,"_targets",void 0),c(this,"_metrics",void 0),c(this,"_survivalTimer",void 0),this._targets=[e,t],this._metrics=t,this._survivalTimer=b()}unregister(e){this._survivalTimer&&this._metrics&&this._survivalTimer.record(this._metrics.instanceSurvivalTime({unregisterTrigger:e})),this._targets.forEach(e=>{try{dt(e)&&R(e.unregister)&&e.unregister()}catch(e){}})}}globalThis.__id5_finalization_registry||(globalThis.__id5_finalization_registry=new class{constructor(){c(this,"_finalizationRegistry",void 0),c(this,"_instancesHolder",void 0),this._instancesHolder=new Set;try{this._finalizationRegistry=new FinalizationRegistry(e=>{try{dt(e)&&R(e.unregister)&&e.unregister("gc-reclaim")}catch(e){}})}catch(e){}}register(e){try{e.getOptions().allowGCReclaim!==L.ASAP&&this._instancesHolder.add(e),this._finalizationRegistry.register(e,e._unregisterTargets,e)}catch(e){}}unregister(e){try{this.releaseInstance(e,!0),this._finalizationRegistry.unregister(e)}catch(e){}}releaseInstance(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];!e.getOptions().allowGCReclaim===L.NEVER&&!t||this._instancesHolder.delete(e)}});const Pt=globalThis.__id5_finalization_registry;class Tt{constructor(e){c(this,"_ref",void 0),this._ref=e}deref(){return this._ref}}class Rt{getOptions(){return this.config.getOptions()}getProvidedOptions(){return this.config.getProvidedOptions()}getInvalidSegments(){return this.config.getInvalidSegments()}getUserId(){return!1===this._isExposed?"0":this._userId}getLinkType(){return!1===this._isExposed?0:this.getExt().linkType}getExt(){var e=!1===this._isExposed?{}:this._ext;return p({abTestingControlGroup:!this.exposeUserId()},e)}isFromCache(){return this._fromCache}exposeUserId(){return this._isExposed}getUserIdAsEid(){return{source:C.ID5_EIDS_SOURCE,uids:[{atype:1,id:this.getUserId(),ext:this.getExt()}]}}onAvailable(e,t){if(R(e))return this._availableCallback?this._log.warn("onAvailable was already called, ignoring"):this._availableCallback=new bt(e,t,this._userIdAvailable,()=>{this._log.debug("Firing onAvailable callback")},this),this;throw new Error("onAvailable expects a function")}onUpdate(e){if(R(e))return this._updateCallback=e,this._userIdAvailable&&this._fireOnUpdate(),this;throw new Error("onUpdate expects a function")}onRefresh(e,t){if(!R(e))throw new Error("onRefresh expects a function");this._refreshCallback&&this._refreshCallback.disableWatchdog();var i=!0===this._isRefreshing&&!1===this._isRefreshingWithFetch&&this._userIdAvailable;return this._refreshCallback=new bt(e,t,i,()=>{this._log.debug("Firing onRefresh callback"),this._isRefreshing=!1,this._isRefreshingWithFetch=!1},this),this}unregister(){try{this._unregisterTargets.unregister("api-call"),Pt.unregister(this)}catch(e){}}constructor(e,t,i,r,s,n,o,a){c(this,"_availableCallback",void 0),c(this,"_updateCallback",void 0),c(this,"_refreshCallback",void 0),c(this,"_isExposed",void 0),c(this,"_fromCache",void 0),c(this,"_isRefreshing",!1),c(this,"_isRefreshingWithFetch",!1),c(this,"_userId",void 0),c(this,"_ext",void 0),c(this,"_userIdAvailable",!1),c(this,"_userIdAvailablePromise",void 0),c(this,"_userIdAvailablePromiseResolver",void 0),c(this,"invocationId",void 0),c(this,"config",void 0),c(this,"clientStore",void 0),c(this,"consentManagement",void 0),c(this,"_consentDataProvider",void 0),c(this,"_metrics",void 0),c(this,"_log",void 0),c(this,"_multiplexingInstance",void 0),c(this,"_pageLevelInfo",void 0),this.config=e,this.clientStore=t,this.consentManagement=i,this._metrics=r,this._consentDataProvider=s,this._log=new G("Id5Instance:",n),this._multiplexingInstance=o,this._userIdAvailablePromise=new Promise(e=>{this._userIdAvailablePromiseResolver=e}),this._pageLevelInfo=a,this._unregisterTargets=new Ot(this._multiplexingInstance,this._metrics),Pt.register(this)}bootstrap(){const n=b();var e=this.config.getOptions();const o=this._ref();this._multiplexingInstance.on(S.CASCADE_NEEDED,e=>{var t=o.deref();t&&t._doCascade(e)}).on(S.USER_ID_READY,(e,t)=>{var i=o.deref();if(i){try{var r=null!=t&&t.tags?h({},t.tags):{},s=i._metrics;null!=t&&t.timestamp&&s.userIdNotificationDeliveryDelayTimer(r).record(Date.now()-t.timestamp),n.record(s.userIdProvisioningDelayTimer(e.isFromCache,h(h({},r),{},{isUpdate:i._userIdAvailable,hasOnAvailable:void 0!==i._availableCallback,hasOnRefresh:void 0!==i._refreshCallback,hasOnUpdate:void 0!==i._updateCallback})))}catch(e){i._log.error("Failed to measure provisioning metrics",e)}i._setUserId(e.responseObj,e.isFromCache,e.willBeRefreshed)}}).on(S.USER_ID_FETCH_CANCELED,e=>{var t=o.deref();t&&t._log.info("ID5 User ID fetch canceled:",e.reason)}),this._log.info("bootstrapped for partner ".concat(e.partnerId," with referer ").concat(this._refererInfo," and options"),this.getProvidedOptions())}firstFetch(){const t=this.config.getOptions();var e=this._gatherFetchIdData().then(e=>{this._multiplexingInstance.register({source:Et,sourceVersion:wt,sourceConfiguration:{options:t},fetchIdData:e,singletonMode:!0===(null===t||void 0===t||null==(e=t.multiplexing)?void 0:e._disabled),canDoCascade:!this.config.hasCreativeRestrictions(),forceAllowLocalStorageGrant:this.consentManagement.isForceAllowLocalStorageGrant(),storageExpirationDays:t.storageExpirationDays})}),i=this._submitRefreshConsent().then(e=>{e&&this.consentManagement.setConsentData(e)});return Promise.allSettled([e,i])}refreshId(t,e){let i,r;this._log.info("ID refresh requested (force=".concat(t,") with additional options "),e);try{this._isRefreshing=!0,this._isRefreshingWithFetch=t,this.config.updOptions(e);var s=this.config.getOptions();const n=s.allowLocalStorageWithoutConsentApi||s.debugBypassConsent;i=this._gatherFetchIdData().then(e=>{this._multiplexingInstance.updateFetchIdData(e),this._multiplexingInstance.refreshUid({resetConsent:!0,forceAllowLocalStorageGrant:n,forceFetch:t}),r=this._submitRefreshConsent()})}catch(e){return this._log.error("Exception caught from refreshId()",e),Promise.reject(e)}return Promise.allSettled([i,r])}_doCascade(e){var t,i,r,s,n=this.config.getOptions();e.partnerId===n.partnerId&&0<=n.maxCascades&&!this.config.hasCreativeRestrictions()&&(i=n.partnerUserId&&0<n.partnerUserId.length,(s=(r=new URL("/".concat(i?"s":"i","/").concat(n.partnerId,"/").concat(n.maxCascades,".gif"),"https://id5-sync.com")).searchParams).set("o","api"),s.set("id5id",e.userId),s.set("gdpr_consent",e.consentString),s.set("gdpr",e.gdprApplies),e.gppString&&(s.set("gpp",e.gppString),s.set("gpp_sid",e.gppSid)),i&&s.set("puid",n.partnerUserId),this._log.info("Opportunities to cascade available",r.href),t=r.href,"loading"!==document.readyState?ht(t):document.addEventListener("DOMContentLoaded",function(){ht(t)}))}_gatherFetchIdData(){var i=this;return n(function*(){var e=i.config.getOptions(),t=yield Ct.gatherUaHints(e.disableUaHints,i._log);return{partnerId:e.partnerId,refererInfo:i._pageLevelInfo.refererInfo,origin:Et,originVersion:i._pageLevelInfo.apiVersion,isUsingCdn:i._pageLevelInfo.isUsingCdn,att:e.att,uaHints:t,abTesting:e.abTesting,segments:e.segments,invalidSegmentsCount:i.getInvalidSegments(),provider:e.provider,pd:e.pd,partnerUserId:e.partnerUserId,refreshInSeconds:e.refreshInSeconds,providedRefreshInSeconds:i.getProvidedOptions().refreshInSeconds,trace:Ze,allowedVendors:null==(t=e.consentData)?void 0:t.allowedVendors,consentSource:"iab"===e.cmpApi?T.cmp:T.partner}})()}_ref(){return new("undefined"!=typeof WeakRef?WeakRef:Tt)(this)}_submitRefreshConsent(){var s=this;return n(function*(){var e=s.config.getOptions(),t=b(),i=e.debugBypassConsent?"bypass":e.cmpApi;let r;try{r=yield s._consentDataProvider.refreshConsentData(e.debugBypassConsent,e.cmpApi,e.consentData),t.record(s._metrics.consentRequestTimer(i,{success:!0,apiType:r.api})),s._multiplexingInstance.updateConsent(r)}catch(e){s._log.error("Couldn't get consent data",e),t.record(s._metrics.consentRequestTimer(i,{success:!1,error:e.message}))}return r})()}_setUserId(e,t){var i=2<arguments.length&&void 0!==arguments[2]&&arguments[2],r=e.universal_uid;if(this._isExposed=!0,U(e.ab_testing))switch(e.ab_testing.result){case"normal":break;default:case"error":this._log.error("There was an error with A/B Testing. Make sure controlGroupRatio is a number >= 0 and <= 1");break;case"control":this._isExposed=!1,this._log.info("User is in control group!")}var s=this._userId!==r||!1===function e(t,i){if(!pt(t)||!pt(i))return t===i;var r=Object.keys(t),s=Object.keys(i);if(r.length!==s.length)return!1;for(var n=0,o=r;n<o.length;n++){var a=o[n];if(!e(t[a],i[a]))return!1}return!0}(this._ext,e.ext);this._userIdAvailable=!0,this._userId=r,this._userIdAvailablePromiseResolver(r),this._ext=e.ext,this._fromCache=t,this._log.info("User id updated",{hasChanged:s,fromCache:t}),this._availableCallback&&this._availableCallback.triggerNow(),this._isRefreshing&&this._refreshCallback&&(!1===t||!1===this._isRefreshingWithFetch)&&this._refreshCallback.triggerNow(),s&&this._fireOnUpdate(),this.getOptions().allowGCReclaim!==L.AFTER_UID_SET||t&&i||Pt.releaseInstance(this)}_fireOnUpdate(){setTimeout(()=>{R(this._updateCallback)&&(this._log.debug("Firing onUpdate"),this._updateCallback(this))},0)}localStorageGrant(){return this.clientStore.localStorageGrant()}collectEvent(t,i){const r=e=>(e=new Request("https://id5-sync.com/event",{method:"POST",mode:"no-cors",body:JSON.stringify({partnerId:this.config.getOptions().partnerId,id5id:e,eventType:t,metadata:i})}),this._log.info("Sending event",e),fetch(e).catch(e=>this._log.error("Error while sending event to ID5 of type "+t,e)));return this._userIdAvailable?r(this._userId):this._userIdAvailablePromise.then(e=>r(e))}}var xt=new class{set debug(e){tt=!!e}get debug(){return rt()}constructor(){c(this,"loaded",!1),c(this,"_isUsingCdn",!1),c(this,"_referer",!1),c(this,"_version",wt),c(this,"versions",{}),c(this,"invocationId",0),this.loaded=!0,this._isUsingCdn=!!(document&&document.currentScript&&document.currentScript.src&&0===document.currentScript.src.indexOf("https://cdn.id5-sync.com")),this._referer=gt(),this.versions[wt]=!0}init(e){this.invocationId+=1;var t=new st(Et,this.invocationId);try{t.info("ID5 API version ".concat(this._version,". Invoking init()"),e);var i=new St(e,t),r=i.getOptions(),s=this._configureDiagnostics(r,t),n=(s&&(s.loadDelayTimer().recordNow(),s.invocationCountSummary().record(this.invocationId,{fenced:"function"==typeof window.Fence&&window.fence instanceof window.Fence})),new fe(window,!i.hasCreativeRestrictions())),o=new pe(n),a=r.allowLocalStorageWithoutConsentApi||r.debugBypassConsent;const g=new be(o,i.storageConfig,a,t,s);var c=new qe(()=>g.localStorageGrant(),o,i.storageConfig,t),l=Xe.createInstance(window,t,s,n),d=new k(s,t),h=new At(this._referer,this._version,this._isUsingCdn),u=new Rt(i,c,g,s,d,t,l,h);return u.bootstrap(),u.firstFetch(),c.scheduleGC(s),u}catch(e){t.error("Exception caught during init()",e)}}refreshId(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(ot(t))return e.refreshId(t,i),e;throw new Error("Invalid usage of refreshId(): second parameter must be a boolean")}_configureDiagnostics(e,t){try{var i,r=e.partnerId,s=new je(Et,wt),n=e.diagnostics;return s.addCommonTags(h(h({},Me(r)),{},{tml:this._referer.topmostLocation,provider:e.provider||"default"})),null!=n&&n.publishingDisabled||(o=n.publishingSampleRatio,i=Math.random()<o&&Ee?(e,t)=>new Ae(void 0,{sampling:o}).publish(e,t):e=>e,null!=n&&n.publishAfterLoadInMsec&&0<n.publishAfterLoadInMsec&&s.schedulePublishAfterMsec(n.publishAfterLoadInMsec,i),null!=n&&n.publishBeforeWindowUnload&&s.schedulePublishBeforeUnload(i)),s}catch(e){t.error("Failed to configure diagnostics",e)}var o}};window.ID5||(window.ID5=xt)}()},{}],7:[function(e,t,i){function v(){for(var e=0,t={};e<arguments.length;e++){var i,r=arguments[e];for(i in r)t[i]=r[i]}return t}t.exports=function e(g){function p(e,t,i){var r,s;if("undefined"!=typeof document){if(1<arguments.length){"number"==typeof(i=v({path:"/"},p.defaults,i)).expires&&((s=new Date).setMilliseconds(s.getMilliseconds()+864e5*i.expires),i.expires=s),i.expires=i.expires?i.expires.toUTCString():"";try{r=JSON.stringify(t),/^[\{\[]/.test(r)&&(t=r)}catch(e){}t=g.write?g.write(t,e):encodeURIComponent(String(t)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=(e=(e=encodeURIComponent(String(e))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape);var n,o="";for(n in i)i[n]&&(o+="; "+n,!0!==i[n])&&(o+="="+i[n]);return document.cookie=e+"="+t+o}e||(r={});for(var a=document.cookie?document.cookie.split("; "):[],c=/(%[0-9A-Z]{2})+/g,l=0;l<a.length;l++){var d=a[l].split("="),h=d.slice(1).join("=");this.json||'"'!==h.charAt(0)||(h=h.slice(1,-1));try{var u=d[0].replace(c,decodeURIComponent);if(h=g.read?g.read(h,u):g(h,u)||h.replace(c,decodeURIComponent),this.json)try{h=JSON.parse(h)}catch(e){}if(e===u){r=h;break}e||(r[u]=h)}catch(e){}}return r}}p.set=p;p.get=function(e){return p.call(p,e)};p.getJSON=function(){return p.apply({json:!0},[].slice.call(arguments))};p.defaults={};p.remove=function(e,t){p(e,"",v(t,{expires:-1}))};p.withConverter=e;return p}(function(){})},{}]},{},[5]);
